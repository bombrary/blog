<!DOCTYPE html>
<html lang="ja-jp">
<title>ReactとD3.jsを使ったWordCloudの作成（備忘録） | Chanomic Blog</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.113.0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://bombrary.github.io/blog/css/index.css">
<link rel="canonical" href="https://bombrary.github.io/blog/posts/react-d3-wordcloud/">
<link rel="alternate" type="application/rss+xml" href="" title="Chanomic Blog">
  <link rel="stylesheet" href="/blog/css/custom.css">

  <link rel="stylesheet" href="/blog/css/syntax.css">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152083322-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-152083322-1');
</script>



<meta property="og:title" content="ReactとD3.jsを使ったWordCloudの作成（備忘録）" />
<meta property="og:description" content="注意 筆者はReact歴1週間なので、筋の良い書き方でなかったり、間違った書き方であったりするかもしれない。 前半は車輪の再発明をしてしまっている。書いている途中にreact-d3-cloudライブラリの存在に気づいたので、記事の最後にサンプルコードを記載している。 プロジェクト準備 このあたりは人によりけりだが、ここでは次のようにする。
Reactのビルド環境はDockerないしDocker Composeで構築。 Reactのプロジェクトはcreate-react-appで構築。 それではまずDocker・Docker Composeの構築から。 プロジェクトディレクトリを適当に作成し、そこにdocker-compose.yamlを書く。
version: &#34;3.0&#34; services: app: image: node:20-slim volumes: - ./app:/src ports: - 3000:3000 command: npm start working_dir: /src 続いて次のコマンドを実行してcreate-react-appを導入し、実行する。
$ docker-compose run --rm app sh -c &#34;npm install -g create-react-app &amp;&amp; create-react-app .&#34; これによりappディレクトリが作成され、中にReactのプロジェクトが生成される。
このタイミングでD3.jsとd3-cloudも入れておく。
docker-compose run --rm app npm install d3 d3-cloud これでサーバーを起動してみると、localhost:3000にアクセスできることがわかるだろう。
$ docker-compouse up ちなみに現状ではapp下のディレクトリがコンテナ内のrootで作成されたため、権限の問題で中のソースコードを編集できない。 VSCodeとかだとRemote Containerという拡張を入れることで解決できるらしいが、Vimユーザの自分にとっての正しい解決策はまだ未調査。 今回は、その場しのぎでsudo chownを使うことで、権限を変更しておく。
ひな形作成 WordCloudというコンポーネントを作成し、そこでD3.jsの要素が動かせるかどうか確かめてみる。
App.jsを次のようにする。
import &#39;./App.css&#39;; import WordCloud from &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bombrary.github.io/blog/posts/react-d3-wordcloud/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-11T12:06:51+09:00" />
<meta property="article:modified_time" content="2023-06-11T20:12:50+09:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ReactとD3.jsを使ったWordCloudの作成（備忘録）"/>
<meta name="twitter:description" content="注意 筆者はReact歴1週間なので、筋の良い書き方でなかったり、間違った書き方であったりするかもしれない。 前半は車輪の再発明をしてしまっている。書いている途中にreact-d3-cloudライブラリの存在に気づいたので、記事の最後にサンプルコードを記載している。 プロジェクト準備 このあたりは人によりけりだが、ここでは次のようにする。
Reactのビルド環境はDockerないしDocker Composeで構築。 Reactのプロジェクトはcreate-react-appで構築。 それではまずDocker・Docker Composeの構築から。 プロジェクトディレクトリを適当に作成し、そこにdocker-compose.yamlを書く。
version: &#34;3.0&#34; services: app: image: node:20-slim volumes: - ./app:/src ports: - 3000:3000 command: npm start working_dir: /src 続いて次のコマンドを実行してcreate-react-appを導入し、実行する。
$ docker-compose run --rm app sh -c &#34;npm install -g create-react-app &amp;&amp; create-react-app .&#34; これによりappディレクトリが作成され、中にReactのプロジェクトが生成される。
このタイミングでD3.jsとd3-cloudも入れておく。
docker-compose run --rm app npm install d3 d3-cloud これでサーバーを起動してみると、localhost:3000にアクセスできることがわかるだろう。
$ docker-compouse up ちなみに現状ではapp下のディレクトリがコンテナ内のrootで作成されたため、権限の問題で中のソースコードを編集できない。 VSCodeとかだとRemote Containerという拡張を入れることで解決できるらしいが、Vimユーザの自分にとっての正しい解決策はまだ未調査。 今回は、その場しのぎでsudo chownを使うことで、権限を変更しておく。
ひな形作成 WordCloudというコンポーネントを作成し、そこでD3.jsの要素が動かせるかどうか確かめてみる。
App.jsを次のようにする。
import &#39;./App.css&#39;; import WordCloud from &#39;."/>


<header>
  
    <a href="https://bombrary.github.io/blog/" class="title">Chanomic Blog</a>
  
  
</header>


<article>
  <header>
    <h1><a href="https://bombrary.github.io/blog/posts/react-d3-wordcloud/">ReactとD3.jsを使ったWordCloudの作成（備忘録）</a></h1>
    <div class="meta">
      
      <div class="pub-date">
        <time datetime="2023-06-11T12:06:51&#43;09:00">June 11, 2023</time>
      </div>
      
      
      <div class="lastmod-date">
        <div class="lastmod-date__label">(last modified:</div>
        <time datetime="2023-06-11T12:06:51&#43;09:00">June 11, 2023</time>
        <div class="lastmod-date__label">)</div>
      </div>
      
    </div>
    
    <div class="tags-categories">
      <div class="tags">
        <p>tags: </p>
        <ul class="tags_list">
          <li class="tags_item"><a href="https://bombrary.github.io/blog//tags/wordcloud/">WordCloud</a></li>
        </ul>
        
      </div>
      <div class="categories">
        <p>categories: </p>
        
        <ul class="categories_list">
           <li class="categories_item"><a href="https://bombrary.github.io/blog//categories/react/">React</a></li> <li class="categories_item"><a href="https://bombrary.github.io/blog//categories/d3.js/">D3.js</a></li>
        </ul>
        
      </div>
    </div>
  </header>
  
  <h2 id="注意">注意</h2>
<ul>
<li>筆者はReact歴1週間なので、筋の良い書き方でなかったり、間違った書き方であったりするかもしれない。</li>
<li>前半は車輪の再発明をしてしまっている。書いている途中に<a href="https://github.com/Yoctol/react-d3-cloud">react-d3-cloud</a>ライブラリの存在に気づいたので、記事の最後にサンプルコードを記載している。</li>
</ul>
<h2 id="プロジェクト準備">プロジェクト準備</h2>
<p>このあたりは人によりけりだが、ここでは次のようにする。</p>
<ul>
<li>Reactのビルド環境はDockerないしDocker Composeで構築。</li>
<li>Reactのプロジェクトは<code>create-react-app</code>で構築。</li>
</ul>
<p>それではまずDocker・Docker Composeの構築から。
プロジェクトディレクトリを適当に作成し、そこに<code>docker-compose.yaml</code>を書く。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">app</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">node:20-slim</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./app:/src</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3000</span><span class="p">:</span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">npm start</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l">/src</span><span class="w">
</span></span></span></code></pre></div><p>続いて次のコマンドを実行して<code>create-react-app</code>を導入し、実行する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ docker-compose run --rm app sh -c <span class="s2">&#34;npm install -g create-react-app &amp;&amp; create-react-app .&#34;</span>
</span></span></code></pre></div><p>これにより<code>app</code>ディレクトリが作成され、中にReactのプロジェクトが生成される。</p>
<p>このタイミングでD3.jsと<a href="https://github.com/jasondavies/d3-cloud">d3-cloud</a>も入れておく。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker-compose run --rm app npm install d3 d3-cloud
</span></span></code></pre></div><p>これでサーバーを起動してみると、<a href="http://localhost:3000">localhost:3000</a>にアクセスできることがわかるだろう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ docker-compouse up
</span></span></code></pre></div><p>ちなみに現状では<code>app</code>下のディレクトリがコンテナ内のrootで作成されたため、権限の問題で中のソースコードを編集できない。
VSCodeとかだとRemote Containerという拡張を入れることで解決できるらしいが、Vimユーザの自分にとっての正しい解決策はまだ未調査。
今回は、その場しのぎで<code>sudo chown</code>を使うことで、権限を変更しておく。</p>
<h2 id="ひな形作成">ひな形作成</h2>
<p><code>WordCloud</code>というコンポーネントを作成し、そこでD3.jsの要素が動かせるかどうか確かめてみる。</p>
<p><code>App.js</code>を次のようにする。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">WordCloud</span> <span class="nx">from</span> <span class="s1">&#39;./component/WordCloud&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">WordCloud</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</span></span></code></pre></div><p><code>component/WordCloud.jsx</code>を次のようにする。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">d3</span> <span class="nx">from</span> <span class="s1">&#39;d3&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useRef</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">cloud</span> <span class="nx">from</span> <span class="s1">&#39;d3-cloud&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">WordCloud</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">svg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cloud</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">ref</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">WordCloud</span><span class="p">;</span>
</span></span></code></pre></div><p>この時点で、デバッグコンソールにsvg要素と<code>d3-cloud</code>のオブジェクトが出力されていればOK。
D3.jsとd3-cloudも認識されているし、svg要素も取得できている。</p>
<h2 id="d3-cloudを用いたワードクラウドの描画">d3-cloudを用いたワードクラウドの描画</h2>
<p>以下のようなコンポーネント<code>MyWordCloud</code>を作成する。</p>
<ul>
<li>ワードクラウドの縦、横の長さ、単語のデータ、フォントファミリーを引数にとる。</li>
<li>ワードクラウドを描画してSVGとして出力する。</li>
</ul>
<p>まず<code>component/WordCloud.jsx</code>を以下のようにする。<a href="https://github.com/jasondavies/d3-cloud/blob/master/examples/browserify.js">d3-cloudのexampleコード</a>を参考に作成した。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">d3</span> <span class="nx">from</span> <span class="s1">&#39;d3&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useRef</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">cloud</span> <span class="nx">from</span> <span class="s1">&#39;d3-cloud&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyWordCloud</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fontFamily</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">draw</span> <span class="o">=</span> <span class="p">(</span><span class="nx">words</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&#34;text&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;text&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&#34;font-size&#34;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb">px`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&#34;font-family&#34;</span><span class="p">,</span> <span class="nx">fontFamily</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;text-anchor&#34;</span><span class="p">,</span> <span class="s2">&#34;middle&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;transform&#34;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="sb">`translate(</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">) rotate(</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">rotate</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">layout</span> <span class="o">=</span> <span class="nx">cloud</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">size</span><span class="p">([</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">words</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">padding</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="o">~~</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">90</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">font</span><span class="p">(</span><span class="nx">fontFamily</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">fontSize</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;end&#34;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">layout</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">ref</span><span class="p">}</span> <span class="na">width</span><span class="o">=</span><span class="p">{</span><span class="nx">width</span><span class="p">}</span> <span class="na">height</span><span class="o">=</span><span class="p">{</span><span class="nx">height</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">g</span> <span class="na">transform</span><span class="o">=</span><span class="p">{</span><span class="sb">`translate(</span><span class="si">${</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="si">}</span><span class="sb">)`</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">g</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">MyWordCloud</span><span class="p">;</span>
</span></span></code></pre></div><p>簡単にわかる範囲だけ書くと、</p>
<ul>
<li><code>cloud()</code>でワードクラウドのオブジェクトを生成し、メソッドチェーンでいろいろ設定をしていく。</li>
<li>ワードクラウドオブジェクトの<code>words</code>メソッドにデータを指定する。これは<code>{ text }</code>を持った配列とする。</li>
<li>ワードの大きさは<code>fontSize</code>で指定する。今回はデータに<code>value</code>属性を持たせているので、それを指定する。</li>
<li>ワードクラウドオブジェクトの<code>start</code>でワードクラウドを生成する。</li>
<li>終了時するときに<code>end</code>イベントが発火するため、そのリスナを<code>on</code>メソッドで指定する。</li>
<li><code>end</code>イベントのリスナの引数は<code>{text, size, x, y, rotate}</code>を持った配列。これらの情報を使ってSVG要素をよしなに生成していけばよい。</li>
<li>ReactのStrictModeの影響で<code>useEffect</code>が2回起こる。その際1回目に生成されてしまったワードクラウドを削除するために、<code>g.selectAll('text').remove()</code>を実行している。
これをやらないとDOMで表示されている要素と実際にDOMと結びついている要素とが食い違い、後の節「クリック時の反応の実装」でおかしなことになるので注意。
<code>remove</code>をしなくても、D3.jsの<a href="https://bost.ocks.org/mike/selection/#enter-update-exit">enter/update/exit</a>のうちupdateを変更するよううまく書けば良いのだが、流れを分かりやすくするため今回は割愛。</li>
</ul>
<p>となっている。</p>
<p>そして<code>App.js</code>は以下のようにする。<code>&lt;WordCloud /&gt;</code>を追加した。<code>SAMPLE_WORDS</code>は<a href="https://github.com/jasondavies/d3-cloud/blob/master/examples/browserify.js">d3-cloudのexampleコード</a>のものと同じ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">MyWordCloud</span> <span class="nx">from</span> <span class="s1">&#39;./component/WordCloud&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">SAMPLE_WORDS</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;Hello&#34;</span><span class="p">,</span> <span class="s2">&#34;world&#34;</span><span class="p">,</span> <span class="s2">&#34;normally&#34;</span><span class="p">,</span> <span class="s2">&#34;you&#34;</span><span class="p">,</span> <span class="s2">&#34;want&#34;</span><span class="p">,</span> <span class="s2">&#34;more&#34;</span><span class="p">,</span> <span class="s2">&#34;words&#34;</span><span class="p">,</span> <span class="s2">&#34;than&#34;</span><span class="p">,</span> <span class="s2">&#34;this&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="p">({</span><span class="nx">text</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">90</span><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">MyWordCloud</span> 
</span></span><span class="line"><span class="cl">         <span class="na">width</span><span class="o">=</span><span class="p">{</span><span class="mi">500</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">height</span><span class="o">=</span><span class="p">{</span><span class="mi">500</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">SAMPLE_WORDS</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">fontFamily</span><span class="o">=</span><span class="s">&#34;Impact&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</span></span></code></pre></div><p>うまくいくと以下のようなページが出力される。</p>
<p><img src="img/wordcloud-example.png" alt="出力結果"></p>
<h2 id="クリック時の反応の実装">クリック時の反応の実装</h2>
<p>クリックしたら、別のコンポーネントにクリックした内容を出力させてみる。</p>
<p>方針としては、<code>[clickedWord, setClickedWord]</code>を<code>useState</code>で生成しておき、テキストがクリックされたときに<code>setClickedWord</code>を呼び出すようにする。<code>clickedWord</code>は別のコンポーネントに読み取らせて描画する。</p>
<p>まず<code>component/WordCloud.jsx</code>の<code>WordCloud</code>関数を次のようにする。<code>onWordClick</code>を追加しただけ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyWordCloud</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fontFamily</span><span class="p">,</span> <span class="nx">onWordClick</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 中略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>まず<code>component/WordCloud.jsx</code>の<code>draw</code>関数を次のようにする。<code>style</code>と<code>on('click', ...)</code>を追加した。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">draw</span> <span class="o">=</span> <span class="p">(</span><span class="nx">words</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&#34;text&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;text&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&#34;font-size&#34;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb">px`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&#34;font-family&#34;</span><span class="p">,</span> <span class="nx">FONT_FAMILY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;text-anchor&#34;</span><span class="p">,</span> <span class="s2">&#34;middle&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&#34;transform&#34;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="sb">`translate(</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">) rotate(</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">rotate</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">&#39;cursor&#39;</span><span class="p">,</span> <span class="s1">&#39;pointer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">onWordClick</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>最後に、<code>App.js</code>を次のようにする。こちらは<code>ClickedWord</code>コンポーネントを作成し、<code>App</code>に設定した。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">MyWordCloud</span> <span class="nx">from</span> <span class="s1">&#39;./component/WordCloud&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">SAMPLE_WORDS</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;Hello&#34;</span><span class="p">,</span> <span class="s2">&#34;world&#34;</span><span class="p">,</span> <span class="s2">&#34;normally&#34;</span><span class="p">,</span> <span class="s2">&#34;you&#34;</span><span class="p">,</span> <span class="s2">&#34;want&#34;</span><span class="p">,</span> <span class="s2">&#34;more&#34;</span><span class="p">,</span> <span class="s2">&#34;words&#34;</span><span class="p">,</span> <span class="s2">&#34;than&#34;</span><span class="p">,</span> <span class="s2">&#34;this&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="p">({</span><span class="nx">text</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">90</span><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ClickedWord</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">word</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span> <span class="nx">word</span> <span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">clickedWord</span><span class="p">,</span> <span class="nx">setClickedWord</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">onWordClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="p">{</span> <span class="nx">text</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setClickedWord</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">MyWordCloud</span> 
</span></span><span class="line"><span class="cl">         <span class="na">width</span><span class="o">=</span><span class="p">{</span><span class="mi">500</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">height</span><span class="o">=</span><span class="p">{</span><span class="mi">500</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">SAMPLE_WORDS</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">onWordClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onWordClick</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="na">fontFamily</span><span class="o">=</span><span class="s">&#34;Impact&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ClickedWord</span> <span class="na">word</span><span class="o">=</span><span class="p">{</span><span class="nx">clickedWord</span><span class="p">}/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</span></span></code></pre></div><p>うまくいくと以下のようなページが出力される。</p>
<p><img src="img/wordcloud-click.png" alt="出力結果"></p>
<h2 id="react-d3-cloudを用いたワードクラウドの描画">react-d3-cloudを用いたワードクラウドの描画</h2>
<p>上記を書いた後に気づいたが、同じことをやってくれるものとして<a href="https://github.com/Yoctol/react-d3-cloud">react-d3-cloud</a>があった。</p>
<p>これを用いると、クリックした処理を実装したワードクラウドは以下のように書ける。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useCallback</span><span class="p">,</span> <span class="nx">useMemo</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">WordCloud</span> <span class="nx">from</span> <span class="s1">&#39;react-d3-cloud&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">SAMPLE_WORDS</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;Hello&#34;</span><span class="p">,</span> <span class="s2">&#34;world&#34;</span><span class="p">,</span> <span class="s2">&#34;normally&#34;</span><span class="p">,</span> <span class="s2">&#34;you&#34;</span><span class="p">,</span> <span class="s2">&#34;want&#34;</span><span class="p">,</span> <span class="s2">&#34;more&#34;</span><span class="p">,</span> <span class="s2">&#34;words&#34;</span><span class="p">,</span> <span class="s2">&#34;than&#34;</span><span class="p">,</span> <span class="s2">&#34;this&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="p">({</span><span class="nx">text</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">90</span><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ClickedWord</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">word</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span> <span class="nx">word</span> <span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">clickedWord</span><span class="p">,</span> <span class="nx">setClickedWord</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">onWordClick</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">e</span><span class="p">,</span> <span class="p">{</span> <span class="nx">text</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setClickedWord</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">fontSize</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">word</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">word</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">rotate</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">((</span><span class="nx">word</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">~~</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">90</span><span class="p">,</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">WordCloud</span> 
</span></span><span class="line"><span class="cl">        <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">SAMPLE_WORDS</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">font</span><span class="o">=</span><span class="s">&#34;Impact&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">fontWeight</span><span class="o">=</span><span class="s">&#34;bold&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">fontSize</span><span class="o">=</span><span class="p">{</span><span class="nx">fontSize</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">rotate</span><span class="o">=</span><span class="p">{</span><span class="nx">rotate</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">padding</span><span class="o">=</span><span class="p">{</span><span class="mi">5</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">random</span><span class="o">=</span><span class="p">{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="na">onWordClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onWordClick</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="p">&lt;</span><span class="nt">ClickedWord</span> <span class="na">word</span><span class="o">=</span><span class="p">{</span><span class="nx">clickedWord</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</span></span></code></pre></div><p>個人的なハマりポイントは<code>useCallback</code>を使う点。これを行わないと、クリックのたびに<code>clickedWord</code>の変更を検知してしまい再レンダーされてしまう。
<a href="https://github.com/Yoctol/react-d3-cloud#how-to-avoid-unnecessary-re-render">README</a>によると<code>&lt;WordCloud&gt;</code>は<code>React.memo</code>を使っているらしいので、
propsの変更がなければ再レンダーされない。そのため、コールバック関数の再生成を防ぐため<code>useCallback</code>を使っている。</p>
<p><img src="img/react-d3-wordcloud.png" alt="react-d3-wordcloud"></p>

</article>



</html>

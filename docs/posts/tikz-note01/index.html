<!DOCTYPE html>
<html lang="ja-jp">
<title>TikZ 備忘録 | Chanomic Blog</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.106.0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://bombrary.github.io/blog/css/index.css">
<link rel="canonical" href="https://bombrary.github.io/blog/posts/tikz-note01/">
<link rel="alternate" type="application/rss+xml" href="" title="Chanomic Blog">
  <link rel="stylesheet" href="/blog/css/custom.css">

  <link rel="stylesheet" href="/blog/css/syntax.css">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152083322-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-152083322-1');
</script>



<meta property="og:title" content="TikZ 備忘録" />
<meta property="og:description" content="毎回マニュアルから情報を探すのが面倒なので、基本的なものをここにまとめたい。個人的に気になったことに対しては深堀して補足しているが、細かいことを気にしすぎた結果、TikZやPGFのソースコードを読みに行く羽目になった。
またここに書いてある内容がベストプラクティスとは限らないことに注意。もっと簡単な書き方があるかもしれない。
情報の集め方 ここに載っているものはほぼTikZ/PGFのマニュアル(CTANの &ldquo;PDF Manual&quot;のこと) に載っている。TeX Liveを導入しているなら、コマンドtexdoc tikzで開くはず。この記事では、なるべく参照した情報を記載するようにする。ここに書いてあることが間違っている場合があるので、何かおかしいなと思ったらマニュアルを参照すること。
知らないキーワードや記号が出てきたらマニュアル末尾のindexで探すと良い。 TikZで出来ることを把握したいなら、Part Iのチュートリアルを読んでみるのが有効。もしくはPartIII, Vあたりを流し読みする。PGF Manualはページ数が膨大なため、全部読もうとするのは恐らく得策では無い。目次を眺めながら興味のあるところをつまむのが良いと思う(読み方について、Introductionの1.4 How to Read This Manualも参照)。 既にやりたいことがあるが、TikZで実現する方法が分からない場合は、ググる。英語のキーワードで検索すれば、大抵Stack Exchangeがヒットする。画像検索も有効。 準備 パッケージ読み込み・この記事での記法の注意 TikZはtikzパッケージから読み込める。
\usepakcage{tikz} 以降、コードを記載するときはこの記述を省略する。
また、TikZには色々な便利なライブラリが用意されている。例えば座標計算に便利なライブラリであるCalcは次のように読み込む。
\usetikzlibrary{calc} 以降、コード中で必要なライブラリがあった場合は、コードの先頭に\usetikzlibraryを記載することにする。 このコマンドは実際にはプリアンブルに書く必要があることに注意。
DVIドライバの指定 必ずクラスオプションにDVIドライバを指定すること。さもなければ、色が出力されなかったり、図形の位置が正確に計算されなかったりする。
以下は、DVIドライバをdvipdfmx、クラスをjsarticleで行う例。
\documentclass[dvipdfmx]{jsarticle} クラスオプションにDVIドライバを指定する必要性については、以下のサイトを参照： 日本語 LaTeX の新常識 2021 - Qiita。
個人的な図の描き方 自分は主にBeamerでスライドを作ったり、論文やレポートなどのLaTeX文書を書いたりするときにTikZを用いる。その場合、以下のワークフローが現状良いと思っている。
書き捨て用のLaTeX文書を作成し、そこにTikZのコードを書く。 満足した出来になったら、スライドや論文、レポートのLaTeX文書に貼り付ける。 1でわざわざ別ファイルで書く理由は、タイプセット時間削減のためである。 本命のLaTeX文書に直接書き込む方式だと、今書いている図形以外のところまでタイプセットの処理が入るため、どうしてもタイプセットの時間が遅くなる（もしかしたら部分的にタイプセットしたり、それ以外の部分をキャッシュで残したりする仕組みがあるのかもしれないが、未調査）。
ちなみにLaTeX文書に埋め込む以外の用途で用いるなら、
生成されたPDF文書を適当に拡大してスクショする：ラスタ形式の画像しか取得できないが、手軽。 standaloneクラスでタイプセットし、それを適当な方法で変換する：例えばdvisvgmを使えばSVGファイルを作れる。 などが考えられる。
色を定義 (TikZの話ではない) TikZではなくxcolorの話だが、大事なのでここで記す。これはtikzパッケージを読み込んだときに自動で読み込まれるようだが、もしxcolor単体で使いたいなら、xcolorパッケージを読み込むこと。
\usepakcage{xcolor} 色同士を!で混ぜることができる。例えばred!20!blue!30!whiteと書くと、赤、青、白がそれぞれ20%、30%、(100-20-30)%混ざった色になる。
カラーコードやRGB値などから定義したい場合は\definecolor、既存の色を混ぜて使いたい場合は\colorletを利用。
\definecolor{mycolor1}{HTML}{888888} # 定義する色名 カラーモデル 色の値 \colorlet{mycolor2}{orange!75!white} # 定義する色名 色 色名に-をつけると補色を表現できる。ただし、ここでの補色はRGBでの補色。例えば-redとすると赤色の補色のシアンとなる。RYBでの補色を使いたい場合は-には頼らず、色を直接\definecolorで指定する必要があると思われる。
文字にマーカーをつける 参考: TikZ で“インラインな”図を描く - Qiita" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bombrary.github.io/blog/posts/tikz-note01/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-30T22:30:00+09:00" />
<meta property="article:modified_time" content="2022-11-26T22:50:27+09:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="TikZ 備忘録"/>
<meta name="twitter:description" content="毎回マニュアルから情報を探すのが面倒なので、基本的なものをここにまとめたい。個人的に気になったことに対しては深堀して補足しているが、細かいことを気にしすぎた結果、TikZやPGFのソースコードを読みに行く羽目になった。
またここに書いてある内容がベストプラクティスとは限らないことに注意。もっと簡単な書き方があるかもしれない。
情報の集め方 ここに載っているものはほぼTikZ/PGFのマニュアル(CTANの &ldquo;PDF Manual&quot;のこと) に載っている。TeX Liveを導入しているなら、コマンドtexdoc tikzで開くはず。この記事では、なるべく参照した情報を記載するようにする。ここに書いてあることが間違っている場合があるので、何かおかしいなと思ったらマニュアルを参照すること。
知らないキーワードや記号が出てきたらマニュアル末尾のindexで探すと良い。 TikZで出来ることを把握したいなら、Part Iのチュートリアルを読んでみるのが有効。もしくはPartIII, Vあたりを流し読みする。PGF Manualはページ数が膨大なため、全部読もうとするのは恐らく得策では無い。目次を眺めながら興味のあるところをつまむのが良いと思う(読み方について、Introductionの1.4 How to Read This Manualも参照)。 既にやりたいことがあるが、TikZで実現する方法が分からない場合は、ググる。英語のキーワードで検索すれば、大抵Stack Exchangeがヒットする。画像検索も有効。 準備 パッケージ読み込み・この記事での記法の注意 TikZはtikzパッケージから読み込める。
\usepakcage{tikz} 以降、コードを記載するときはこの記述を省略する。
また、TikZには色々な便利なライブラリが用意されている。例えば座標計算に便利なライブラリであるCalcは次のように読み込む。
\usetikzlibrary{calc} 以降、コード中で必要なライブラリがあった場合は、コードの先頭に\usetikzlibraryを記載することにする。 このコマンドは実際にはプリアンブルに書く必要があることに注意。
DVIドライバの指定 必ずクラスオプションにDVIドライバを指定すること。さもなければ、色が出力されなかったり、図形の位置が正確に計算されなかったりする。
以下は、DVIドライバをdvipdfmx、クラスをjsarticleで行う例。
\documentclass[dvipdfmx]{jsarticle} クラスオプションにDVIドライバを指定する必要性については、以下のサイトを参照： 日本語 LaTeX の新常識 2021 - Qiita。
個人的な図の描き方 自分は主にBeamerでスライドを作ったり、論文やレポートなどのLaTeX文書を書いたりするときにTikZを用いる。その場合、以下のワークフローが現状良いと思っている。
書き捨て用のLaTeX文書を作成し、そこにTikZのコードを書く。 満足した出来になったら、スライドや論文、レポートのLaTeX文書に貼り付ける。 1でわざわざ別ファイルで書く理由は、タイプセット時間削減のためである。 本命のLaTeX文書に直接書き込む方式だと、今書いている図形以外のところまでタイプセットの処理が入るため、どうしてもタイプセットの時間が遅くなる（もしかしたら部分的にタイプセットしたり、それ以外の部分をキャッシュで残したりする仕組みがあるのかもしれないが、未調査）。
ちなみにLaTeX文書に埋め込む以外の用途で用いるなら、
生成されたPDF文書を適当に拡大してスクショする：ラスタ形式の画像しか取得できないが、手軽。 standaloneクラスでタイプセットし、それを適当な方法で変換する：例えばdvisvgmを使えばSVGファイルを作れる。 などが考えられる。
色を定義 (TikZの話ではない) TikZではなくxcolorの話だが、大事なのでここで記す。これはtikzパッケージを読み込んだときに自動で読み込まれるようだが、もしxcolor単体で使いたいなら、xcolorパッケージを読み込むこと。
\usepakcage{xcolor} 色同士を!で混ぜることができる。例えばred!20!blue!30!whiteと書くと、赤、青、白がそれぞれ20%、30%、(100-20-30)%混ざった色になる。
カラーコードやRGB値などから定義したい場合は\definecolor、既存の色を混ぜて使いたい場合は\colorletを利用。
\definecolor{mycolor1}{HTML}{888888} # 定義する色名 カラーモデル 色の値 \colorlet{mycolor2}{orange!75!white} # 定義する色名 色 色名に-をつけると補色を表現できる。ただし、ここでの補色はRGBでの補色。例えば-redとすると赤色の補色のシアンとなる。RYBでの補色を使いたい場合は-には頼らず、色を直接\definecolorで指定する必要があると思われる。
文字にマーカーをつける 参考: TikZ で“インラインな”図を描く - Qiita"/>


<header>
  
    <a href="https://bombrary.github.io/blog/" class="title">Chanomic Blog</a>
  
  
</header>


<article>
  <header>
    <h1><a href="https://bombrary.github.io/blog/posts/tikz-note01/">TikZ 備忘録</a></h1>
    <div class="meta">
      
      <div class="pub-date">
        <time datetime="2021-07-30T22:30:00&#43;09:00">July 30, 2021</time>
      </div>
      
      
      <div class="lastmod-date">
        <div class="lastmod-date__label">(last modified:</div>
        <time datetime="2021-07-30T22:30:00&#43;09:00">November 26, 2022</time>
        <div class="lastmod-date__label">)</div>
      </div>
      
    </div>
    
    <div class="tags-categories">
      <div class="tags">
        <p>tags: </p>
        <ul class="tags_list">
          <li class="tags_item"><a href="https://bombrary.github.io/blog//tags/%e4%bd%9c%e5%9b%b3/">作図</a></li>
        </ul>
        
      </div>
      <div class="categories">
        <p>categories: </p>
        
        <ul class="categories_list">
           <li class="categories_item"><a href="https://bombrary.github.io/blog//categories/tikz/">TikZ</a></li> <li class="categories_item"><a href="https://bombrary.github.io/blog//categories/latex/">LaTeX</a></li>
        </ul>
        
      </div>
    </div>
  </header>
  
    <aside>
      <h2>目次</h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#情報の集め方">情報の集め方</a></li>
    <li><a href="#準備">準備</a>
      <ul>
        <li><a href="#パッケージ読み込みこの記事での記法の注意">パッケージ読み込み・この記事での記法の注意</a></li>
        <li><a href="#dviドライバの指定">DVIドライバの指定</a></li>
        <li><a href="#個人的な図の描き方">個人的な図の描き方</a></li>
      </ul>
    </li>
    <li><a href="#色を定義-tikzの話ではない">色を定義 (TikZの話ではない)</a></li>
    <li><a href="#文字にマーカーをつける">文字にマーカーをつける</a>
      <ul>
        <li><a href="#補足-スタイルを使い回す">(補足) スタイルを使い回す</a></li>
      </ul>
    </li>
    <li><a href="#shape">Shape</a>
      <ul>
        <li><a href="#矢印">矢印</a></li>
        <li><a href="#込み入った補足-shape-border-rotateの挙動">(込み入った補足): shape border rotateの挙動</a></li>
      </ul>
    </li>
    <li><a href="#矢印の形を変える">矢印の形を変える</a>
      <ul>
        <li><a href="#巨大な矢印">巨大な矢印</a></li>
      </ul>
    </li>
    <li><a href="#点の上にラベルをつける">点の上にラベルをつける</a></li>
    <li><a href="#線分を曲げる">線分を曲げる</a>
      <ul>
        <li><a href="#bend-rightbend-leftの初期値">bend right/bend leftの初期値</a></li>
      </ul>
    </li>
    <li><a href="#ベクトルや線分">ベクトルや線分</a>
      <ul>
        <li><a href="#2点間の内分点外分点">2点間の内分点、外分点</a></li>
        <li><a href="#2点間の任意の長さのベクトル">2点間の任意の長さのベクトル</a></li>
        <li><a href="#ベクトルを任意の角度をずらす">ベクトルを任意の角度をずらす</a></li>
        <li><a href="#垂線">垂線</a></li>
        <li><a href="#垂線縦軸または横軸に対して">垂線（縦軸または横軸に対して）</a></li>
        <li><a href="#ベクトルを平行にずらす">ベクトルを平行にずらす</a></li>
      </ul>
    </li>
    <li><a href="#交点の計算">交点の計算</a></li>
    <li><a href="#斜線で領域を塗る">斜線で領域を塗る</a></li>
    <li><a href="#並べる方法">並べる方法</a>
      <ul>
        <li><a href="#相対位置で指定する">相対位置で指定する</a></li>
        <li><a href="#matrixで指定する">matrixで指定する</a></li>
      </ul>
    </li>
    <li><a href="#文字を揃えて並べる">文字を揃えて並べる</a></li>
    <li><a href="#node関連">node関連</a>
      <ul>
        <li><a href="#サイズ変更">サイズ変更</a></li>
        <li><a href="#改行できるようにする">改行できるようにする</a></li>
        <li><a href="#矢印とノードとの余白を空ける">矢印とノードとの余白を空ける</a></li>
      </ul>
    </li>
    <li><a href="#繰り返し文">繰り返し文</a></li>
    <li><a href="#関数を使う">関数を使う</a>
      <ul>
        <li><a href="#込み入った補足-波括弧curly-bracesについて">(込み入った補足) 波括弧(curly braces)について</a></li>
      </ul>
    </li>
    <li><a href="#x座標y座標を個別に取得">x座標、y座標を個別に取得</a></li>
    <li><a href="#レイヤを使う">レイヤを使う</a></li>
    <li><a href="#囲み枠fitting-library利用">囲み枠（Fitting Library利用）</a></li>
    <li><a href="#関数のグラフの描画">関数のグラフの描画</a></li>
    <li><a href="#座標を使った平行移動">座標を使った平行移動</a></li>
    <li><a href="#図を拡大縮小するtikzの話ではない">図を拡大縮小する（TikZの話ではない）</a></li>
  </ul>
</nav>
    </aside>
    
  <p>毎回マニュアルから情報を探すのが面倒なので、基本的なものをここにまとめたい。個人的に気になったことに対しては深堀して補足しているが、細かいことを気にしすぎた結果、TikZやPGFのソースコードを読みに行く羽目になった。</p>
<p>またここに書いてある内容がベストプラクティスとは限らないことに注意。もっと簡単な書き方があるかもしれない。</p>
<h2 id="情報の集め方">情報の集め方</h2>
<p>ここに載っているものはほぼTikZ/PGFのマニュアル(<a href="https://ctan.org/pkg/pgf">CTAN</a>の &ldquo;PDF Manual&quot;のこと) に載っている。TeX Liveを導入しているなら、コマンド<code>texdoc tikz</code>で開くはず。この記事では、なるべく参照した情報を記載するようにする。ここに書いてあることが間違っている場合があるので、何かおかしいなと思ったらマニュアルを参照すること。</p>
<ul>
<li>知らないキーワードや記号が出てきたらマニュアル末尾のindexで探すと良い。</li>
<li>TikZで出来ることを把握したいなら、Part Iのチュートリアルを読んでみるのが有効。もしくはPartIII, Vあたりを流し読みする。PGF Manualはページ数が膨大なため、全部読もうとするのは恐らく得策では無い。目次を眺めながら興味のあるところをつまむのが良いと思う(読み方について、Introductionの1.4 How to Read This Manualも参照)。</li>
<li>既にやりたいことがあるが、TikZで実現する方法が分からない場合は、ググる。英語のキーワードで検索すれば、大抵Stack Exchangeがヒットする。画像検索も有効。</li>
</ul>
<h2 id="準備">準備</h2>
<h3 id="パッケージ読み込みこの記事での記法の注意">パッケージ読み込み・この記事での記法の注意</h3>
<p>TikZは<code>tikz</code>パッケージから読み込める。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usepakcage</span><span class="nb">{</span>tikz<span class="nb">}</span>
</span></span></code></pre></div><p>以降、コードを記載するときはこの記述を省略する。</p>
<p>また、TikZには色々な便利なライブラリが用意されている。例えば座標計算に便利なライブラリであるCalcは次のように読み込む。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc<span class="nb">}</span>
</span></span></code></pre></div><p>以降、コード中で必要なライブラリがあった場合は、コードの先頭に<code>\usetikzlibrary</code>を記載することにする。
このコマンドは実際にはプリアンブルに書く必要があることに注意。</p>
<h3 id="dviドライバの指定">DVIドライバの指定</h3>
<p>必ずクラスオプションにDVIドライバを指定すること。さもなければ、色が出力されなかったり、図形の位置が正確に計算されなかったりする。</p>
<p>以下は、DVIドライバを<code>dvipdfmx</code>、クラスを<code>jsarticle</code>で行う例。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\documentclass</span><span class="na">[dvipdfmx]</span><span class="nb">{</span>jsarticle<span class="nb">}</span>
</span></span></code></pre></div><p>クラスオプションにDVIドライバを指定する必要性については、以下のサイトを参照：
<a href="https://qiita.com/wtsnjp/items/76557b1598445a1fc9da#%E6%96%B0%E5%B8%B8%E8%AD%98-2-dvi-%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90%E3%81%AF%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E6%98%8E%E7%A4%BA%E3%81%97%E3%82%88%E3%81%86">日本語 LaTeX の新常識 2021 - Qiita</a>。</p>
<h3 id="個人的な図の描き方">個人的な図の描き方</h3>
<p>自分は主にBeamerでスライドを作ったり、論文やレポートなどのLaTeX文書を書いたりするときにTikZを用いる。その場合、以下のワークフローが現状良いと思っている。</p>
<ol>
<li>書き捨て用のLaTeX文書を作成し、そこにTikZのコードを書く。</li>
<li>満足した出来になったら、スライドや論文、レポートのLaTeX文書に貼り付ける。</li>
</ol>
<p>1でわざわざ別ファイルで書く理由は、タイプセット時間削減のためである。
本命のLaTeX文書に直接書き込む方式だと、今書いている図形以外のところまでタイプセットの処理が入るため、どうしてもタイプセットの時間が遅くなる（もしかしたら部分的にタイプセットしたり、それ以外の部分をキャッシュで残したりする仕組みがあるのかもしれないが、未調査）。</p>
<p>ちなみにLaTeX文書に埋め込む以外の用途で用いるなら、</p>
<ul>
<li>生成されたPDF文書を適当に拡大してスクショする：ラスタ形式の画像しか取得できないが、手軽。</li>
<li><code>standalone</code>クラスでタイプセットし、それを適当な方法で変換する：例えば<code>dvisvgm</code>を使えばSVGファイルを作れる。</li>
</ul>
<p>などが考えられる。</p>
<h2 id="色を定義-tikzの話ではない">色を定義 (TikZの話ではない)</h2>
<p>TikZではなくxcolorの話だが、大事なのでここで記す。これは<code>tikz</code>パッケージを読み込んだときに自動で読み込まれるようだが、もしxcolor単体で使いたいなら、<code>xcolor</code>パッケージを読み込むこと。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usepakcage</span><span class="nb">{</span>xcolor<span class="nb">}</span>
</span></span></code></pre></div><p>色同士を<code>!</code>で混ぜることができる。例えば<code>red!20!blue!30!white</code>と書くと、赤、青、白がそれぞれ20%、30%、(100-20-30)%混ざった色になる。</p>
<p>カラーコードやRGB値などから定義したい場合は<code>\definecolor</code>、既存の色を混ぜて使いたい場合は<code>\colorlet</code>を利用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\definecolor</span><span class="nb">{</span>mycolor1<span class="nb">}{</span>HTML<span class="nb">}{</span>888888<span class="nb">}</span> # 定義する色名 カラーモデル 色の値
</span></span><span class="line"><span class="cl"><span class="k">\colorlet</span><span class="nb">{</span>mycolor2<span class="nb">}{</span>orange!75!white<span class="nb">}</span> # 定義する色名 色
</span></span></code></pre></div><p>色名に<code>-</code>をつけると補色を表現できる。ただし、ここでの補色はRGBでの補色。例えば<code>-red</code>とすると赤色の補色のシアンとなる。RYBでの補色を使いたい場合は<code>-</code>には頼らず、色を直接<code>\definecolor</code>で指定する必要があると思われる。</p>
<h2 id="文字にマーカーをつける">文字にマーカーをつける</h2>
<p><strong>参考</strong>: <a href="https://qiita.com/zr_tex8r/items/61d14cec3f54972578ea#%E6%B0%97%E3%81%A5%E3%81%8B%E3%82%8C%E3%81%AA%E3%81%84tikz">TikZ で“インラインな”図を描く - Qiita</a></p>
<ul>
<li><code>\tikz</code>は<code>tikzpicture</code>環境がコマンドになっただけで、使い方は同じ。</li>
<li><code>\tikz</code>コマンドのオプション引数<code>baseline</code>で位置を補正。</li>
<li><code>inner sep</code>や<code>outer sep</code>で余白調整。</li>
<li>高さを固定したい場合は<code>minimum height</code>で調整。</li>
<li>枠の下に文字を配置したい場合は、<code>remember picture</code>と<code>overlay</code>を利用。
<code>overlay</code>を使わず直接<code>\tikz</code>の中に書いても良いが、文字が多すぎると左右に余計な余白が空く。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>positioning<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  f(x) =
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T1.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=orange!20!white, inner sep=0pt, outer sep=0, minimum height=4ex] (T1) <span class="nb">{</span><span class="s">$</span><span class="nb">q</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl">  p(x) +
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T2.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=red!20!white, inner sep=0pt, outer sep=0, minimum height=4ex] (T2) <span class="nb">{</span><span class="s">$</span><span class="nb">r</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>[remember picture, overlay]
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=0pt of T1, text=orange!80!black] <span class="nb">{</span>商<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=0pt of T2, text=red!80!black] <span class="nb">{</span>余り<span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/color-box.png"/>
</figure>

<h3 id="補足-スタイルを使い回す">(補足) スタイルを使い回す</h3>
<p>スタイルを使いまわしたい場合は、以下の3つの状況において<code>名前/.style={スタイル}</code>のように指定する。</p>
<ul>
<li><code>\tikz</code>のオプション引数に指定</li>
<li><code>tikzpicture</code>環境のオプション引数に指定</li>
<li><code>\tikzset</code>を利用</li>
</ul>
<p>今回は異なる<code>\tikz</code>の間でスタイルを使いまわしたいので<code>tikzset</code>が適当。以下のように使う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\tikzset</span><span class="nb">{</span>box/.style=<span class="nb">{</span>inner sep=0pt, outer sep=0, minimum height=4ex<span class="nb">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  f(x) =
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T1.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=orange!20!white, box] (T1) <span class="nb">{</span><span class="s">$</span><span class="nb">q</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl">  p(x) +
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T2.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=red!20!white, box] (T2) <span class="nb">{</span><span class="s">$</span><span class="nb">r</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span></code></pre></div><p>なお、<code>style</code>には引数が指定できる。<code>#1</code>で引数を参照する。スタイルを適用したい要素のオプション引数にて、<code>名前=引数</code>のように使う。2個以上の引数を指定したい場合は<code>style n args</code>を使えばいいらしい。(<code>style</code>の参考: PGF Manual, Part VII, 87.4.4 Defining Styles)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\tikzset</span><span class="nb">{</span>box/.style=<span class="nb">{</span>inner sep=1pt, outer sep=0, minimum height=#1<span class="nb">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  f(x) =
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T1.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=orange!20!white, box=4ex] (T1) <span class="nb">{</span><span class="s">$</span><span class="nb">q</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl">  p(x) +
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T2.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=red!20!white, box=4ex] (T2) <span class="nb">{</span><span class="s">$</span><span class="nb">r</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span></code></pre></div><h2 id="shape">Shape</h2>
<p><strong>参考</strong>: PGF Manual, Part V, 71 Shape Library</p>
<p>Shapeライブラリでは色々な図形が定義されている。種類は色々あるのでPDFマニュアル参照。</p>
<h3 id="矢印">矢印</h3>
<p>(<strong>補足</strong> Shapeライブラリを使わない方法も後で紹介している。）</p>
<p><code>shapes.arrows</code>で<code>single arrow</code>として定義されている。</p>
<ul>
<li><code>single arrow</code>で矢印を描画。</li>
<li><code>arrow head extend</code>で矢印の先端の幅を設定。</li>
<li><code>minimum height</code>で長さ調整。</li>
<li><code>shape border rotate=-90</code>で向きを設定。それに伴い<code>shape border incircle</code>を設定しておく(後述)。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>shapes.arrows<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> at (0, 0) <span class="nb">{</span>命題Pが真<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [fill=red, single arrow, single arrow head extend=2mm,
</span></span><span class="line"><span class="cl">         minimum height=8mm, shape border uses incircle,
</span></span><span class="line"><span class="cl">         shape border rotate=-90] at (0, 1cm) <span class="nb">{}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> at (0, 2cm) <span class="nb">{</span>命題Qが真<span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><p><code>shape border uses incircle</code>は、shapeの境界線が内接円を使って構成されているかどうかを決定するキー、
とマニュアルには書いてあったが、いまいちよくわからなかった…。
<code>shape border rotate</code>の説明曰く、
<code>shape border uses incircle</code>を設定しない状態で<code>shape border rotate=a</code>を設定すると、<code>a</code>の部分が
「90度の整数倍に最も近い数」に丸められて解釈されるらしい。</p>
<p>(参考: PGF Manual, Part II, 17.2.3 Common Options)</p>
<figure><img src="./img/arrow-shape.png"/>
</figure>

<h3 id="込み入った補足-shape-border-rotateの挙動">(込み入った補足): shape border rotateの挙動</h3>
<p>「90度の整数倍に最も近い数」に丸められるのであれば、<code>-90</code>のとき<code>shape border uses incircle</code>を設定しなくても良いのではないか、と思うが、実際にやってみると<code>-90</code>は<code>0</code>と解釈される。
<code>-90</code>ではなく<code>270</code>を指定すると、ちゃんと-90度回転される。この理由を知るために、該当ソースコードを探して読んだ。</p>
<p>この計算は、おそらく<a href="https://github.com/pgf-tikz/pgf/blob/master/tex/generic/pgf/libraries/shapes/pgflibraryshapes.geometric.code.tex#L3644">このソースコード</a>で行っている。</p>
<ol>
<li>角度aに45度加える。</li>
<li>1を90で割る。</li>
<li>2に90を掛ける。</li>
</ol>
<p>要するに、<code>(a + 45) / 90 * 90</code>を計算している。ただし、<code>/</code>は整数の除算を表す。
この答えは負数の切り捨て方に依存する。Pythonでは<code>-1 // 2 == -1</code>となる。Pythonでは負の方向に丸められるようだ。
ではTeXではどうなのかというと、割り算の結果は単純に切り捨てになる模様。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\newcount\x</span>
</span></span><span class="line"><span class="cl"><span class="k">\x</span>=-1
</span></span><span class="line"><span class="cl"><span class="k">\divide\x</span>2
</span></span><span class="line"><span class="cl">計算結果: <span class="k">\the\x</span>
</span></span></code></pre></div><figure><img src="./img/tex-division.png"/>
</figure>

<p>よって、<code>(-90 + 45) / 90 * 90</code>は<code>0</code>と計算される。</p>
<h2 id="矢印の形を変える">矢印の形を変える</h2>
<p><strong>参考</strong>: PGF Manual, Part III, 16.4.4 Defining Shorthands</p>
<p>終端を変えたいなら<code>&gt;</code>を設定する。他にも色々あるのでマニュアル参照。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;]                     (0,0) -- (1,0);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=Stealth]          (0,-0.5) -- (1,-0.5);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=<span class="nb">{</span>Stealth[round]<span class="nb">}</span>] (0,-1.0) -- (1,-1.0);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=Latex]            (0,-1.5) -- (1,-1.5);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=<span class="nb">{</span>Latex[round]<span class="nb">}</span>]   (0,-2.0) -- (1,-2.0);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/arrows.png"/>
</figure>

<h3 id="巨大な矢印">巨大な矢印</h3>
<p>Shapeライブラリの<code>single arrows</code>を使ってもよいが、以下のように<code>Triangle</code>の矢印を使うことで同じ図形を再現できる。パラメータは以下の通り。</p>
<ul>
<li><code>\draw</code>の<code>line width</code>：線の太さ。</li>
<li><code>\draw</code>の<code>Triangle</code>：
<ul>
<li><code>width</code>：矢印の幅。</li>
<li><code>length</code>：矢印の長さ。</li>
</ul>
</li>
</ul>
<p><code>outer sep</code>は始点と終点の空白を制御する。詳しくは後述。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [outer sep=2pt] (p) at (0, 0) <span class="nb">{</span>命題Pが真<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [outer sep=2pt] (q) at (0, 2cm) <span class="nb">{</span>命題Qが真<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;,
</span></span><span class="line"><span class="cl">         &gt;=<span class="nb">{</span>Triangle[width=10mm, length=5mm]<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">         line width=6mm,
</span></span><span class="line"><span class="cl">         red] (q) -- (p);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/big-arrow.png"/>
</figure>

<p>Shapeライブラリの場合は矢印を回転させて使う必要があるが、こちらは向きは自動で変わる。そのため多くの場合はこちらのほうが使いやすいかもしれない。</p>
<h2 id="点の上にラベルをつける">点の上にラベルをつける</h2>
<p><strong>参考</strong>: PGF Manual, Part III, 17.10 The Label and Pin Options</p>
<p><code>coordinate</code>や<code>node</code>に<code>label</code>キーを指定すると、例えば図形の点の上にラベルをつけることができる。
例えば以下のようなコードがあったとする。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>positioning<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (a) circle [radius=2pt];
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [left=0pt of a] <span class="nb">{</span><span class="s">$</span><span class="nb">A</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/node-label.png"/>
</figure>

<p>これが少しだけ簡単になる。
<code>left:</code>を指定しなかった場合はデフォルトで<code>above:</code>が付く。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> [label=left:<span class="s">$</span><span class="nb">A</span><span class="s">$</span>] (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (a) circle [radius=2pt];
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><h2 id="線分を曲げる">線分を曲げる</h2>
<p><strong>参考</strong>: PGF Manual, Part V, 74 To Path Library</p>
<p>自由に曲線を描きたいなら、<code>\path</code>の<code>controls</code>を使えば良い(参考: PGF Manual, PartIII, 14.3 The Curve-To Operation)。しかしベジェ曲線に慣れていないと、思い通りの曲線を描くのは大変。しかし、シンプルなケースであればTo Path Libraryを使えば簡単に描ける。</p>
<p>例えば「線分をある方向に曲げたい場合は、<code>bend right</code>や<code>bend left</code>が使える。これはTo Path Library で提供されている。以下のように<code>to</code>の引数に指定する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (2,0);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [blue] (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [red] (a) to [bend left] (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [green!50!black] (a) to [bend right] (b);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/path-bend.png"/>
</figure>

<p><code>bend right/bend left</code>は、グラフ構造を描く際に利用できる。また以下のように、図形の長さを明示したいときに使える。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (2,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (c) at (2,2);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (d) at (0,2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) -- (b) -- (c) -- (d) -- cycle;
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [line width=0.2pt] (a) to [bend left=60] node [fill=white, midway] <span class="nb">{</span> <span class="s">$</span><span class="m">1</span><span class="s">$</span>cm <span class="nb">}</span> (d);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/length-square.png"/>
</figure>

<p>代わりに<code>out</code>と<code>in</code>を使うと、出ていくときの角度と入っていくときの角度が指定できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, angles, quotes<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (4,0);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) to [out=45, in=120] (b);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">% 補助線の描画
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\draw</span> [red, dashed] (a) -- ++(45:1cm) coordinate (a1);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [red, dashed] (b) -- ++(120:1cm) coordinate (b1);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a2) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)+(</span><span class="m">1</span><span class="nb">,</span><span class="m">0</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b2) at (<span class="s">$</span><span class="o">(</span><span class="nb">b</span><span class="o">)+(</span><span class="m">1</span><span class="nb">,</span><span class="m">0</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [dashed] (b) -- (b2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> pic [&#34;<span class="s">$</span><span class="m">45</span><span class="nb">^</span><span class="nv">\circ</span><span class="s">$</span>&#34;, draw, font=<span class="k">\footnotesize</span>, angle eccentricity=1.5]
</span></span><span class="line"><span class="cl">    <span class="nb">{</span> angle=a2--a--a1 <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> pic [&#34;<span class="s">$</span><span class="m">120</span><span class="nb">^</span><span class="nv">\circ</span><span class="s">$</span>&#34;, draw, font=<span class="k">\footnotesize</span>, angle eccentricity=1.5]
</span></span><span class="line"><span class="cl">    <span class="nb">{</span> angle=b2--b--b1 <span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/path-in-out.png"/>
</figure>

<h3 id="bend-rightbend-leftの初期値">bend right/bend leftの初期値</h3>
<p><code>bend left</code>のデフォルト値はマニュアルによると&rdquo;(default last value)&ldquo;と書かれているが、last valueが無い場合の初期値は何なのか不明だったので調べた。<a href="https://github.com/pgf-tikz/pgf/blob/master/tex/generic/pgf/frontendlayer/tikz/libraries/tikzlibrarytopaths.code.tex#L30">ソースコード</a>によると、<code>\tikz@to@bend</code>で定義されているようだ。それは<a href="https://github.com/pgf-tikz/pgf/blob/master/tex/generic/pgf/frontendlayer/tikz/libraries/tikzlibrarytopaths.code.tex#L119">ここ</a>で設定されているようで、どうやら30度の模様。</p>
<h2 id="ベクトルや線分">ベクトルや線分</h2>
<p><strong>参考</strong>: PGF Manual, Part III, 13.5 Coordinate Calculations</p>
<p>座標計算にはCalcライブラリが非常に便利。座標同士の足し算や定数倍が行える他、以下で説明する内分点、回転などの計算が行える。</p>
<h3 id="2点間の内分点外分点">2点間の内分点、外分点</h3>
<p><code>($(a)!0.2!(b)$)</code>とすると、ab 上の点pで、ap = 0.2ab を満たすものが計算できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> [label=<span class="s">$</span><span class="nb">A</span><span class="s">$</span>] (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> [label=<span class="s">$</span><span class="nb">B</span><span class="s">$</span>] (b) at (4,2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (a) circle [radius=2pt];
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (b) circle [radius=2pt];
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">0</span><span class="nb">.</span><span class="m">2</span><span class="o">!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>) node [label=<span class="s">$</span><span class="nb">P</span><span class="s">$</span>] <span class="nb">{}</span> circle [radius=2pt];
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [dashed] (a) -- (b);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/dividing-piont.png"/>
</figure>

<h3 id="2点間の任意の長さのベクトル">2点間の任意の長さのベクトル</h3>
<p><code>($(a)!1cm!(b)$)</code>とすると、ab 上の点pで、ap = 1cm を満たすものが計算できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (2,1);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=Stealth] (a) -- (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">3</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">2</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>) circle [radius=1pt];
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">1</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>) circle [radius=1pt];
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/length-point.png"/>
</figure>

<h3 id="ベクトルを任意の角度をずらす">ベクトルを任意の角度をずらす</h3>
<p><code>($(a)!1cm!30:(b)$)</code>とすると、「abを30度回転させた線分」 上の点pで、ap = 1cm を満たすものが計算できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, angles, quotes, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (t) at (2,1);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b1) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">2</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">t</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b2) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">2</span><span class="nb">cm</span><span class="o">!</span><span class="m">30</span><span class="nb">:</span><span class="o">(</span><span class="nb">t</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=Stealth] (a) -- (b1);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=Stealth] (a) -- (b2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> pic [&#34;<span class="s">$</span><span class="m">30</span><span class="nb">^</span><span class="nv">\circ</span><span class="s">$</span>&#34;, font=<span class="k">\footnotesize</span>, draw, angle eccentricity=1.5]
</span></span><span class="line"><span class="cl">    <span class="nb">{</span> angle=b1--a--b2 <span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/rotate-point.png"/>
</figure>

<h3 id="垂線">垂線</h3>
<p><code>($(a)!(c)!(b)$)</code>とすると、c から ab へ下ろした垂線の足を計算できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, angles, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (2,-1);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (c) at (2,1);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (p) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!(</span><span class="nb">c</span><span class="o">)!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [&lt;-, &gt;=Stealth] (c) -- node [midway, auto] <span class="nb">{</span><span class="s">$</span><span class="nb">w</span><span class="s">$</span><span class="nb">}</span> (p);
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> pic [draw, angle radius=2mm] <span class="nb">{</span> right angle=b--p--c <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [xshift=-2mm] at (a) <span class="nb">{</span><span class="s">$</span><span class="nb">A</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [xshift=2mm] at (b) <span class="nb">{</span><span class="s">$</span><span class="nb">B</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [yshift=2mm] at (c) <span class="nb">{</span><span class="s">$</span><span class="nb">C</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/perpendicular.png"/>
</figure>

<p>ab 上にある点 c を通る垂線を引きたいなら、線分cbを90度回転させれば良い。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">    <span class="k">\coordinate</span> (b) at (2,-1);
</span></span><span class="line"><span class="cl">    <span class="k">\coordinate</span> (c) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">1</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> (a) -- (b);
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> [-&gt;, &gt;=Stealth] (c) -- (<span class="s">$</span><span class="o">(</span><span class="nb">c</span><span class="o">)!</span><span class="m">1</span><span class="nb">cm</span><span class="o">!</span><span class="m">90</span><span class="nb">:</span><span class="o">(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [xshift=-2mm] at (a) <span class="nb">{</span><span class="s">$</span><span class="nb">A</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [xshift=2mm] at (b) <span class="nb">{</span><span class="s">$</span><span class="nb">B</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [yshift=-2.5mm] at (c) <span class="nb">{</span><span class="s">$</span><span class="nb">C</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/perpendicular2.png"/>
</figure>

<h3 id="垂線縦軸または横軸に対して">垂線（縦軸または横軸に対して）</h3>
<p><strong>参考</strong>: PGF Manual, Part III, 13.3.1 Intersections of Perpendicular Lines</p>
<p>前節では垂線を求めるのに3点の座標を使ったが、特別なケースでは2点で垂線を引くことができるので、それを紹介する。</p>
<p><code>(c |- a)</code>とすると、c から 「aを通る、横軸に平行な直線」との垂線の足を求められる。
前節では垂線の足を求めるためにはbの座標が必要だったが、横軸に平行な場合は必要ない。</p>
<p>ちなみに見方を変えると「cを通る、縦軸に平行な直線」との垂線の足とも捉えられる。
また、<code>(a -| c)</code>のように逆向きに書くことが可能である。
<code>(a |- c)</code>なのか<code>(c |- a)</code>なのか混乱するかもしれないが、その都度実際に描画してみて確認すれば良いと思う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (2,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (c) at (1, 1);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (p) at (c |- a);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) -- (p);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [dotted] (p) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (c) -- (p);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [xshift=-2mm] at (a) <span class="nb">{</span><span class="s">$</span><span class="nb">A</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [xshift=2mm] at (b) <span class="nb">{</span><span class="s">$</span><span class="nb">B</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [yshift=2mm] at (c) <span class="nb">{</span><span class="s">$</span><span class="nb">C</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/perpendicular3.png"/>
</figure>

<p>垂線の足としての使い方だけでなく、「2点A, Cを始点として横軸方向、縦軸方向にそれぞれ伸ばし、ぶつかった点を計算する」という用途で使うこともある。例えば、以下は黒枠でノードを囲む例である（実は <a href="#%E5%9B%B2%E3%81%BF%E6%9E%A0fitting-library%E5%88%A9%E7%94%A8">Fitting Library</a> を使うともっと直感的に書ける）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>[every node/.style=<span class="nb">{</span>draw, circle<span class="nb">}</span>]
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> (a) at (0,0) <span class="nb">{</span><span class="s">$</span><span class="nb">A</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> (b) at (1.5,0.5) <span class="nb">{</span><span class="s">$</span><span class="nb">B</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> (c) at (1,1) <span class="nb">{</span><span class="s">$</span><span class="nb">C</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [dashed] (c.north  -| a.west) rectangle (a.south -| b.east);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/perpendicular4.png"/>
</figure>

<h3 id="ベクトルを平行にずらす">ベクトルを平行にずらす</h3>
<p>xy軸ごとの移動方向vが決まっているなら、<code>$(a) + (v)$</code>みたいに計算するか、、<code>scope</code>環境でくくって<code>xshift</code>と<code>yshift</code>を使えば良い(<strong>参考</strong>: PGF Manual, Part III, 25.3 Coordinate Transformations)。</p>
<p>もし「ベクトルabを平行移動したいが、移動の向きはabの法線方向にしたい」という場合は、次のように c、d を計算する。</p>
<p><code>($(a)!1cm!90:(b)$)</code>については以前説明した通り。<code>($(b)+(c)-(a)$)</code>で、「点bをベクトルacだけ移動した点」を計算している。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (t) at (4,2);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">1</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">t</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) -- (t);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (c) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">0</span><span class="nb">.</span><span class="m">2</span><span class="nb">cm</span><span class="o">!</span><span class="m">90</span><span class="nb">:</span><span class="o">(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (d) at (<span class="s">$</span><span class="o">(</span><span class="nb">b</span><span class="o">)+(</span><span class="nb">c</span><span class="o">)-(</span><span class="nb">a</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, &gt;=Stealth, thick, red] (c) -- node [midway, auto] <span class="nb">{</span><span class="s">$</span><span class="nb">v</span><span class="s">$</span><span class="nb">}</span> (d);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/arrow-shift.png"/>
</figure>

<h2 id="交点の計算">交点の計算</h2>
<p><strong>参考</strong> PFG Manual, Part III, 13.3.2 Intersections of Arbitrary Paths</p>
<p><code>name path</code>でパスの名前を指定して、<code>name intersections</code>でパス同士の交点を計算する。
<code>name intersections</code>について、<code>of</code>に2つのパス名を指定する。
<code>by</code>には交点の名前を指定する。円と線分には2つの交点があるので、<code>by</code>に2つの名前を指定している。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>intersections<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>[&gt;=Stealth, arrows.meta]
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (e1) at (-1, 0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (e2) at (1, 0);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name path=circle1] circle [x radius=0.5cm, y radius=1cm];
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name path=line1] (e1) -- (e2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name intersections=<span class="nb">{</span>of=circle1 and line1, by=<span class="nb">{</span>b,a<span class="nb">}}</span>];
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (c) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!</span><span class="m">0</span><span class="nb">.</span><span class="m">5</span><span class="o">!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;] (0.5cm, 0) arc [start angle=0, end angle=-360, x radius=0.5cm, y radius=1cm];
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (e1) -- (c);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [densely dotted] (e1) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;] (b) -- (e2);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/intersection.png"/>
</figure>

<h2 id="斜線で領域を塗る">斜線で領域を塗る</h2>
<p><strong>参考</strong>: PGF Manual, Part V, 62 Pattern Library</p>
<p>Patternsライブラリを使えば良い。<code>pattern</code>で使いたいパターンを指定し、<code>pattern color</code>で色を設定。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>patterns<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (0,0) -- (3,0);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [green!70!black, thick] (1.5,0) -- (1.5,0.5);
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> [green!70!black] (1.5,0.5) to [bend left=45] (2.0,0.5) to [bend left=45] cycle;
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> [green!70!black] (1.5,0.5) to [bend right=45] (1.0,0.5) to [bend right=45] cycle;
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [pattern=north east lines, pattern color=brown] (0,0) rectangle (3, -1);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/pattern.png"/>
</figure>

<h2 id="並べる方法">並べる方法</h2>
<h3 id="相対位置で指定する">相対位置で指定する</h3>
<p><strong>参考</strong></p>
<ul>
<li>PGF Manual, Prat III, 17.5.3 Advanced Placement Options</li>
<li>PGF Manual, Part III, 19 Specifying Graphs</li>
</ul>
<p>位置の指定には、<code>right=1cm of (a)</code>だったり、<code>($(a)!0.5!(b)$)</code>を利用。</p>
<p><code>graph</code>を使うと、グラフがより簡潔に書ける。<code>\draw [-&gt;] (x1) -- (x2);</code>みたいに矢印を1つずつ描かず、
直感的な記述でノード間の関係を記述できる。
<code>\graph</code>の<code>edges</code>パラメータで、グラフ内の辺のスタイルを設定できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, positioning, graphs, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  [entity-x/.style=<span class="nb">{</span>draw, circle<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   entity-u/.style=<span class="nb">{</span>draw<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   entity-y/.style=<span class="nb">{</span>draw<span class="nb">}</span>]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [entity-x] (x1) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [right=1cm of x1, entity-x] (x2) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [right=1cm of x2, entity-x] (x3) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">3</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (x0) at (<span class="s">$</span><span class="o">(</span><span class="nb">x</span><span class="m">1</span><span class="o">)-(</span><span class="m">1</span><span class="nb">,</span><span class="m">0</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (x4) at (<span class="s">$</span><span class="o">(</span><span class="nb">x</span><span class="m">3</span><span class="o">)+(</span><span class="m">1</span><span class="nb">,</span><span class="m">0</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (x1-2) at (<span class="s">$</span><span class="o">(</span><span class="nb">x</span><span class="m">1</span><span class="o">)!</span><span class="m">0</span><span class="nb">.</span><span class="m">5</span><span class="o">!(</span><span class="nb">x</span><span class="m">2</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (x2-3) at (<span class="s">$</span><span class="o">(</span><span class="nb">x</span><span class="m">2</span><span class="o">)!</span><span class="m">0</span><span class="nb">.</span><span class="m">5</span><span class="o">!(</span><span class="nb">x</span><span class="m">3</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [above=1cm of x1-2, entity-u] (u1) <span class="nb">{</span><span class="s">$</span><span class="nb">u_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [above=1cm of x2-3, entity-u] (u2) <span class="nb">{</span><span class="s">$</span><span class="nb">u_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=1cm of x1, entity-y] (y1) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=1cm of x2, entity-y] (y2) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=1cm of x3, entity-y] (y3) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">3</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\graph</span> [edges=<span class="nb">{</span>&gt;=Stealth<span class="nb">}</span>]<span class="nb">{</span>
</span></span><span class="line"><span class="cl">    (x0) -&gt; (x1) -&gt; (x2) -&gt; (x3) -&gt; (x4);
</span></span><span class="line"><span class="cl">    (u1) -&gt; (x1-2);
</span></span><span class="line"><span class="cl">    (u2) -&gt; (x2-3);
</span></span><span class="line"><span class="cl">    (x1) -&gt; (y1);
</span></span><span class="line"><span class="cl">    (x2) -&gt; (y2);
</span></span><span class="line"><span class="cl">    (x3) -&gt; (y3);
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/positioning.png"/>
</figure>

<h3 id="matrixで指定する">matrixで指定する</h3>
<p><strong>参考</strong>: PGF Manual, Part III, 20 Matrices and Alignment</p>
<p><code>\matrix</code>を使うと、図形やノードを格子上に並べることができる。
<code>row sep</code>や<code>column sep</code>の指定に注意 (図の赤文字を参考)。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>graphs, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  [entity-x/.style=<span class="nb">{</span>draw, circle<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   entity-u/.style=<span class="nb">{</span>draw<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   entity-y/.style=<span class="nb">{</span>draw<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   &gt;=Stealth]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">\matrix</span> [row sep=1cm, column sep=0.5cm] <span class="nb">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-u] (u1) <span class="nb">{</span><span class="s">$</span><span class="nb">u_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-u] (u2) <span class="nb">{</span><span class="s">$</span><span class="nb">u_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span><span class="k">\\</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x0) at (0,0);   <span class="nb">&amp;</span> <span class="k">\node</span> [entity-x] (x1) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x1-2) at (0,0); <span class="nb">&amp;</span> <span class="k">\node</span> [entity-x] (x2) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x2-3) at (0,0); <span class="nb">&amp;</span> <span class="k">\node</span> [entity-x] (x3) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">3</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x4) at (0,0);<span class="k">\\</span>
</span></span><span class="line"><span class="cl">      <span class="nb">&amp;</span> <span class="k">\node</span> [entity-y] (y1) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-y] (y2) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-y] (y3) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">3</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span><span class="k">\\</span>
</span></span><span class="line"><span class="cl">   <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\graph</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    (x0) -&gt; (x1) -&gt; (x2) -&gt; (x3) -&gt; (x4);
</span></span><span class="line"><span class="cl">    (u1) -&gt; (x1-2);
</span></span><span class="line"><span class="cl">    (u2) -&gt; (x2-3);
</span></span><span class="line"><span class="cl">    (x1) -&gt; (y1);
</span></span><span class="line"><span class="cl">    (x2) -&gt; (y2);
</span></span><span class="line"><span class="cl">    (x3) -&gt; (y3);
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (<span class="s">$</span><span class="o">(</span><span class="nb">x</span><span class="m">1</span><span class="nb">.east</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> </span><span class="o">(</span><span class="m">0</span><span class="nb">,</span><span class="m">2</span><span class="nb">cm</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [red, dashed] (x1.east) -- (a);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [red, &lt;-&gt;] (u1.west) -- node [midway, auto, font=<span class="k">\footnotesize</span>] <span class="nb">{</span> <span class="s">$</span><span class="m">0</span><span class="nb">.</span><span class="m">5</span><span class="s">$</span>cm <span class="nb">}</span> (<span class="s">$</span><span class="o">(</span><span class="nb">x</span><span class="m">1</span><span class="nb">.east</span><span class="o">)!(</span><span class="nb">u</span><span class="m">1</span><span class="nb">.west</span><span class="o">)!(</span><span class="nb">a</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/matrix.png"/>
</figure>

<h2 id="文字を揃えて並べる">文字を揃えて並べる</h2>
<p>ノードの端を揃えたいときは、<code>anchor</code>をうまく使う。</p>
<h2 id="node関連">node関連</h2>
<p><strong>参考</strong>: PGF Manual, Part III, 17.2.3 Common Options: Separations, Margins, Padding and Border Rotation</p>
<h3 id="サイズ変更">サイズ変更</h3>
<p><code>minimum width</code>、<code>minimum height</code>を使う。ノード同士のサイズを合わせたいならこれを使うとよい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>graphs, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  [entity-x/.style=<span class="nb">{</span>draw, circle, minimum height=4ex<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   entity-u/.style=<span class="nb">{</span>draw, minimum width=4ex, minimum height=4ex<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   entity-y/.style=<span class="nb">{</span>draw, minimum width=4ex, minimum height=4ex<span class="nb">}</span>,
</span></span><span class="line"><span class="cl">   &gt;=Stealth]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">\matrix</span> [row sep=1cm, column sep=0.2cm] <span class="nb">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-u] (u1) <span class="nb">{</span><span class="s">$</span><span class="nb">u_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-u] (u2) <span class="nb">{</span><span class="s">$</span><span class="nb">u_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span><span class="k">\\</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x0) at (0,0);   <span class="nb">&amp;</span> <span class="k">\node</span> [entity-x] (x1) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x1-2) at (0,0); <span class="nb">&amp;</span> <span class="k">\node</span> [entity-x] (x2) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x2-3) at (0,0); <span class="nb">&amp;</span> <span class="k">\node</span> [entity-x] (x3) <span class="nb">{</span><span class="s">$</span><span class="nb">x_</span><span class="m">3</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (x4) at (0,0);<span class="k">\\</span>
</span></span><span class="line"><span class="cl">      <span class="nb">&amp;</span> <span class="k">\node</span> [entity-y] (y1) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">1</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-y] (y2) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">2</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span> <span class="nb">&amp;</span> <span class="k">\node</span> [entity-y] (y3) <span class="nb">{</span><span class="s">$</span><span class="nb">y_</span><span class="m">3</span><span class="s">$</span><span class="nb">}</span>; <span class="nb">&amp;</span><span class="k">\\</span>
</span></span><span class="line"><span class="cl">   <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\graph</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    (x0) -&gt; (x1) -&gt; (x2) -&gt; (x3) -&gt; (x4);
</span></span><span class="line"><span class="cl">    (u1) -&gt; (x1-2);
</span></span><span class="line"><span class="cl">    (u2) -&gt; (x2-3);
</span></span><span class="line"><span class="cl">    (x1) -&gt; (y1);
</span></span><span class="line"><span class="cl">    (x2) -&gt; (y2);
</span></span><span class="line"><span class="cl">    (x3) -&gt; (y3);
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/node-width-height.png"/>
</figure>

<h3 id="改行できるようにする">改行できるようにする</h3>
<p><code>node</code>のオプション引数に<code>align</code>を設定する。<code>center</code>、<code>left</code>、<code>right</code>などが指定できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>positioning<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  f(x) =
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T1.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=orange!20!white, box=4ex] (T1) <span class="nb">{</span><span class="s">$</span><span class="nb">q_</span><span class="m">1</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> q_</span><span class="m">2</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> </span><span class="nv">\cdots</span><span class="nb"> </span><span class="o">+</span><span class="nb"> q_n</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl">  p(x) +
</span></span><span class="line"><span class="cl">  <span class="k">\tikz</span><span class="na">[remember picture, baseline=(T2.base)]</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fill=red!20!white, box=4ex] (T2) <span class="nb">{</span><span class="s">$</span><span class="nb">r</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>align*<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>[remember picture, overlay]
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=0pt of T1, text=orange!80!black, align=center]
</span></span><span class="line"><span class="cl">    <span class="nb">{</span>商<span class="k">\\</span><span class="na">[-1ex]</span>
</span></span><span class="line"><span class="cl">    (文章1)<span class="k">\\</span><span class="na">[-1ex]</span>
</span></span><span class="line"><span class="cl">    (文章2)<span class="k">\\</span><span class="na">[-1ex]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [below=0pt of T2, text=red!80!black, align=center]
</span></span><span class="line"><span class="cl">    <span class="nb">{</span>余り<span class="k">\\</span><span class="na">[-1ex]</span>
</span></span><span class="line"><span class="cl">    (文章1)<span class="k">\\</span><span class="na">[-1ex]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/node-align.png"/>
</figure>

<h3 id="矢印とノードとの余白を空ける">矢印とノードとの余白を空ける</h3>
<p>手軽な方法として2つ思い浮かんだ。1つ目は、<code>node</code>側で<code>outer sep</code>を指定する方法。始点と終点の余白を同じにしたいならこちらの方法が簡潔。2つ目は、<code>draw</code>側で<code>shorten &lt;</code>と<code>shorten &gt;</code>を指定する方法。それぞれ始点と終点の長さを指定できるため自由度が高い。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [draw, outer sep=4pt] (a) at (0,0) <span class="nb">{</span><span class="s">$</span><span class="nb">a</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [draw, outer sep=4pt] (b) at (1,0) <span class="nb">{</span><span class="s">$</span><span class="nb">b</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [draw] (c) at (0,1) <span class="nb">{</span><span class="s">$</span><span class="nb">c</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [draw] (d) at (1,1) <span class="nb">{</span><span class="s">$</span><span class="nb">d</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span><span class="na">[-&gt;]</span> (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span><span class="na">[-&gt;, shorten &lt;=2pt, shorten &gt;=4pt]</span> (c) -- (d);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/padding.png"/>
</figure>

<h2 id="繰り返し文">繰り返し文</h2>
<p><strong>参考</strong>: PGF Manual, Part VII, 88 Repeating Things: The Foreach Statement</p>
<p><code>\foreach</code>が用意されている。<code>{0.5,1,...,3}</code>のように、規則性を持つリストは<code>...</code>で省略できる場合がある。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> circle [radius=0.25];
</span></span><span class="line"><span class="cl">  <span class="k">\foreach</span> <span class="k">\r</span> in <span class="nb">{</span>0.5,1,...,3<span class="nb">}</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> [orange, thick] (80:<span class="k">\r</span>) arc [radius=<span class="k">\r</span>, start angle=80, delta angle=-60];
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/wave.png"/>
</figure>

<p>C言語の<code>if</code>や<code>for</code>文みたいに、繰り返したい対象が1文の場合はブロック<code>{}</code>で括らなくても良い。</p>
<p>また、複数のパラメータを<code>/</code>で区切って使用できる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\foreach</span> <span class="k">\x</span>/<span class="k">\l</span> in <span class="nb">{</span>1/A, 2/B, 3/C, 4/D<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [draw, circle] at (<span class="k">\x</span>, 0) <span class="nb">{</span><span class="s">$</span><span class="nv">\l</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/foreach2.png"/>
</figure>

<h2 id="関数を使う">関数を使う</h2>
<p><strong>参考</strong>: PGF Manual, Part VIII, 94 Mathematical Expressions</p>
<p>これはTikZの話というより、TikZが内部で利用しているPGFの話になる。</p>
<p><code>cos</code>や<code>sin</code>などの基本的な関数が使える。関数を評価したいときは<code>{}</code>で囲む。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\foreach</span> <span class="k">\theta</span> in <span class="nb">{</span>0,5,10,...,359<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\fill</span> (<span class="nb">{</span>(1+cos(<span class="k">\theta</span>))*cos(<span class="k">\theta</span>)<span class="nb">}</span>, <span class="nb">{</span>(1+cos(<span class="k">\theta</span>))*sin(<span class="k">\theta</span>)<span class="nb">}</span>)
</span></span><span class="line"><span class="cl">      circle [radius=1pt];
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/mathparse.png"/>
</figure>

<p>関数以外にも色々な2項演算子や定数が用意されているようなので、マニュアルを見てみると良い。
array-likeなデータ構造も用意されているらしい。</p>
<h3 id="込み入った補足-波括弧curly-bracesについて">(込み入った補足) 波括弧(curly braces)について</h3>
<p>以下のような、関数を使わない場合は波括弧をつけなくても良いようだ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (1+2, 3) circle [radius=1pt];
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><p>もちろん波括弧をつけても良い。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (<span class="nb">{</span>1+2<span class="nb">}</span>, 3) circle [radius=1pt];
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><p>しかし、マニュアルでは波括弧はarray-likeなオブジェクトを表す記号のはず。内部では<code>1+2</code>も<code>{1+2}</code>もともに<code>3</code>と評価されているようだ。この理由が気になる。</p>
<p>まず波括弧の処理がどこで行われているのかを探す。TikZの計算で例外的に波括弧が処理されるのか、それとも<code>\pgfmathparse</code>で処理されるのか。</p>
<p>まずTikZのソースコードを覗いてみる。
色々探してみたところ、canvas座標系での計算は
<a href="https://github.com/pgf-tikz/pgf/blob/master/tex/generic/pgf/frontendlayer/tikz/tikz.code.tex#L4996">ここ</a>
でやっているようだ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\tikzdeclarecoordinatesystem</span><span class="nb">{</span>canvas<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\tikzset</span><span class="nb">{</span>cs/.cd,x=0pt,y=0pt,#1<span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\pgfpoint</span><span class="nb">{</span><span class="k">\tikz</span>@cs@x<span class="nb">}{</span><span class="k">\tikz</span>@cs@y<span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">}</span><span class="c">%
</span></span></span></code></pre></div><p>座標の計算はここでは行わず、<code>\pgfpoint</code>に頼っている。そこで<a href="https://github.com/pgf-tikz/pgf/blob/master/tex/generic/pgf/basiclayer/pgfcorepoints.code.tex#L56">pgfpointのソースコード</a>を見に行く。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\def\pgfpoint</span>#1#2<span class="nb">{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\pgfmathsetlength\pgf</span>@x<span class="nb">{</span>#1<span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\pgfmathsetlength\pgf</span>@y<span class="nb">{</span>#2<span class="nb">}</span><span class="k">\ignorespaces</span><span class="nb">}</span>
</span></span></code></pre></div><p><code>\pgf@x</code>、<code>\pgf@y</code>というのは、xy座標を入れるためのレジスタだと予想できる。続いて、<a href="https://github.com/pgf-tikz/pgf/blob/master/tex/generic/pgf/math/pgfmathcalc.code.tex#L35">pgfmathsetlengthのソースコード</a>を見にいく。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\def\pgfmathsetlength</span>#1#2<span class="nb">{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\expandafter\pgfmath</span>@onquick#2<span class="k">\pgfmath</span>@<span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="nb">{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="c">% ...略
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="nb">{</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="k">\pgfmathparse</span><span class="nb">{</span>#2<span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>    <span class="c">% ...略
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="nb">}</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="k">\ignorespaces</span><span class="c">%
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nb">}</span>
</span></span></code></pre></div><p>このタイミングで<code>\pgfmathparse</code>が呼び出されているようだ。<code>\pgfmathparse</code>で式を評価し、<code>\pgfmathresult</code>で評価結果を取得しているようである。</p>
<p>結局、波括弧をつけるか否かは<code>\pgfmathparse</code>及びその結果である<code>\pgfmathresult</code>に委ねられているようだ。<code>\pgfmathparse</code>のコードを読む気力がなかったので、<code>\show</code>マクロで展開結果を見てみる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="c">% 数字のパース
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="k">\pgfmathparse</span><span class="nb">{</span>1<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\show\pgfmathresult</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">% 波括弧で括られた数字のパース
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="k">\pgfmathparse</span><span class="nb">{{</span>1<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\show\pgfmathresult</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">% array-likeなオブジェクトのパース
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="k">\pgfmathparse</span><span class="nb">{{</span>1,2,3<span class="nb">}}</span>
</span></span><span class="line"><span class="cl"><span class="k">\show\pgfmathresult</span>
</span></span></code></pre></div><p>これでタイプセットしてみる。</p>
<pre class="cui">
> \pgfmathresult=macro:
->1.
l.280 \show\pgfmathresult

?
> \pgfmathresult=macro:
->1.
l.283 \show\pgfmathresult

?
> \pgfmathresult=macro:
->{1}{2}{3}.
l.286 \show\pgfmathresult
</pre>

<p>初めの2つは<code>1</code>と展開され、最後の1つは<code>{1}{2}{3}</code>と展開された。
どうやら波括弧の要素が1つの場合は結果が波括弧で包まれないらしい。</p>
<p>ただし、以下の計算はエラーになるので、<code>{1}</code>はarray-likeではあるようだ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\pgfmathparse</span><span class="nb">{{</span>1<span class="nb">}</span> + 2<span class="nb">}</span>
</span></span></code></pre></div><h2 id="x座標y座標を個別に取得">x座標、y座標を個別に取得</h2>
<p><strong>参考</strong>: PGF Manual, Part III, 14.15 The Let Operation</p>
<p><code>let</code>を使う。<code>let</code>を使うと、座標や値を入れるレジスタが作成できる。</p>
<p>以下は、反射角の計算のために<code>let</code>を使っている。<code>\p&lt;name&gt;</code>、<code>\n&lt;name&gt;</code>は特殊なレジスタ。前者は点の座標を保持し、<code>\x&lt;name&gt;</code>、<code>\y&lt;name&gt;</code>で点の座標にアクセスできる。後者は値を保持し、<code>\n&lt;name&gt;</code>でアクセスできる。<code>&lt;name&gt;</code>の部分には、数字や<code>{文字列}</code>が指定できる例えば<code>\p1</code>、<code>\p{foo}</code>のように使う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>[&gt;=Stealth]
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0.5, 2);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (5, 0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (o) at (0,0);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [name path=line1] (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name path=line2] (o) -- (1cm:15);
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name intersections=<span class="nb">{</span>of=line1 and line2, by=<span class="nb">{</span>p<span class="nb">}}</span>];
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;] (o) -- (p);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;]
</span></span><span class="line"><span class="cl">      let <span class="k">\p</span>1 = (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)</span><span class="nb"> </span><span class="o">-</span><span class="nb"> </span><span class="o">(</span><span class="nb">p</span><span class="o">)</span><span class="s">$</span>),
</span></span><span class="line"><span class="cl">          <span class="k">\p</span>2 = (<span class="s">$</span><span class="o">(</span><span class="nb">o</span><span class="o">)</span><span class="nb"> </span><span class="o">-</span><span class="nb"> </span><span class="o">(</span><span class="nb">p</span><span class="o">)</span><span class="s">$</span>),
</span></span><span class="line"><span class="cl">          <span class="k">\n</span>1 = <span class="nb">{</span>atan2(<span class="k">\y</span>2, <span class="k">\x</span>2)-atan2(<span class="k">\y</span>1, <span class="k">\x</span>1)<span class="nb">}</span>
</span></span><span class="line"><span class="cl">      in
</span></span><span class="line"><span class="cl">      (p) -- (<span class="s">$</span><span class="o">(</span><span class="nb">p</span><span class="o">)!</span><span class="m">2</span><span class="nb">cm</span><span class="o">!-</span><span class="nv">\n</span><span class="m">1</span><span class="nb">:</span><span class="o">(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/reflection-let.png"/>
</figure>

<p>座標計算を行いたい多くの場合は、<code>let</code>を使わなくても解決できる気がする。例えば反射の場合は、一旦延長してから垂線を伸ばせば良い。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, arrows.meta<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>[&gt;=Stealth]
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0.5, 2);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (5, 0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (o) at (0,0);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [name path=line1] (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name path=line2] (o) -- ++(1cm:15);
</span></span><span class="line"><span class="cl">  <span class="k">\path</span> [name intersections=<span class="nb">{</span>of=line1 and line2, by=<span class="nb">{</span>p<span class="nb">}}</span>];
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (q) at (<span class="s">$</span><span class="o">(</span><span class="nb">p</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> </span><span class="o">(</span><span class="nb">o</span><span class="o">)!</span><span class="m">2</span><span class="nb">cm</span><span class="o">!(</span><span class="nb">p</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (r) at (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!(</span><span class="nb">q</span><span class="o">)!(</span><span class="nb">b</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (s) at (<span class="s">$</span><span class="o">(</span><span class="nb">q</span><span class="o">)!</span><span class="m">2</span><span class="o">!(</span><span class="nb">r</span><span class="o">)</span><span class="s">$</span>);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;] (o) -- (p);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [dashed] (p) -- (q) -- (s);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;] (p) -- (s);
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/reflection-calc.png"/>
</figure>

<p>PGF Manualでは「直線に接する円」を描画するために<code>let</code>を使っていた。例えば半径のような、座標以外の計算をしたい場合に<code>let</code>式が有効なのだと思う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (a) at (0,0);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (b) at (2,1);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (c) at (0.5,1.5);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> (a) -- (b);
</span></span><span class="line"><span class="cl">  <span class="k">\fill</span> (c) circle [radius=1pt];
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> let <span class="k">\p</span>1 = (<span class="s">$</span><span class="o">(</span><span class="nb">a</span><span class="o">)!(</span><span class="nb">c</span><span class="o">)!(</span><span class="nb">b</span><span class="o">)</span><span class="nb"> </span><span class="o">-</span><span class="nb"> </span><span class="o">(</span><span class="nb">c</span><span class="o">)</span><span class="s">$</span>)
</span></span><span class="line"><span class="cl">        in
</span></span><span class="line"><span class="cl">        (c) circle [radius=<span class="nb">{</span>veclen(<span class="k">\x</span>1,<span class="k">\y</span>1)<span class="nb">}</span>];
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/inscribed-circle.png"/>
</figure>

<h2 id="レイヤを使う">レイヤを使う</h2>
<p><strong>参考</strong> PGF Manual, Part IX, 113 Layered Graphics</p>
<p>描画順を制御したいときがたまにある。そんなときはレイヤの仕組みを使う。</p>
<p>TikZコマンドは、基本的に書いた順に実行され、図形が重ねられる。
そのため、描画順を変えたいなら、素朴にはTikZコマンドの順番を変えれば良い。
しかし、「各ノードの座標を考慮した上で、それらを囲む色付き枠を作る」ような場合だと、
素朴な方法ではできなくはないもののコード量が増える（未検証ではあるが、<code>\coordinate</code>で座標を定義する部分と、それを使って<code>node</code>を定義する部分に分ければできるはず）。</p>
<p><code>\pgfdeflarelayer</code>で新しいレイヤーをセットし、<code>\pgfsetlayers</code>でレイヤの描画順を設定する。
ただし、<code>main</code>レイヤーは特殊なレイヤ（後述）のため、必ず指定する必要がある。
以下は、<code>background</code>レイヤを定義し、それを<code>main</code>の後ろに設定する例。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\pgfdeflarelayer</span><span class="nb">{</span>background<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\pgfsetlayers</span><span class="nb">{</span>background, main<span class="nb">}</span>
</span></span></code></pre></div><p>実際に特定のレイヤに対して描画を行うときは<code>pgfonlayer</code>環境を使う。
<code>main</code>レイヤだけは特殊で、<code>pgfonlayer</code>で指定しなかったTikZのコマンドはすべて<code>main</code>レイヤで描画される。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>positioning, graphs<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\pgfdeclarelayer</span><span class="nb">{</span>background<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\pgfsetlayers</span><span class="nb">{</span>background, main<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\matrix</span> [row sep=2em, column sep=2em,
</span></span><span class="line"><span class="cl">           entity/.style=<span class="nb">{</span>draw, circle,
</span></span><span class="line"><span class="cl">                          minimum width=3em,
</span></span><span class="line"><span class="cl">                          outer sep=3pt,
</span></span><span class="line"><span class="cl">                          fill=white<span class="nb">}</span>] <span class="nb">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (instart) at (0,0);
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (in0) <span class="nb">{</span> <span class="s">$</span><span class="nb">u_{k</span><span class="o">-</span><span class="m">1</span><span class="nb">}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (in1) <span class="nb">{</span> <span class="s">$</span><span class="nb">u_{k}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\\</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">\node</span> [] (ststart) <span class="nb">{</span> <span class="s">$</span><span class="nv">\cdots</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (st0) <span class="nb">{</span> <span class="s">$</span><span class="nb">x_{k</span><span class="o">-</span><span class="m">1</span><span class="nb">}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (st1) <span class="nb">{</span> <span class="s">$</span><span class="nb">x_{k}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [] (stend) <span class="nb">{</span> <span class="s">$</span><span class="nv">\cdots</span><span class="s">$</span> <span class="nb">}</span>;<span class="k">\\</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (ob0) <span class="nb">{</span> <span class="s">$</span><span class="nb">y_{k</span><span class="o">-</span><span class="m">1</span><span class="nb">}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (ob1) <span class="nb">{</span> <span class="s">$</span><span class="nb">y_{k}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\coordinate</span> (obend) at (0,0); <span class="k">\\</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\graph</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">      (ststart) -&gt; (st0) -&gt; (st1) -&gt; (stend);
</span></span><span class="line"><span class="cl">      (in0) -&gt; (st0) -&gt; (ob0);
</span></span><span class="line"><span class="cl">      (in1) -&gt; (st1) -&gt; (ob1);
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (strect start) at (in0.north -| ststart.south west);
</span></span><span class="line"><span class="cl">  <span class="k">\coordinate</span> (strect end) at (st1.south -| stend.south east);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\begin</span><span class="nb">{</span>pgfonlayer<span class="nb">}{</span>background<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\fill</span> [blue!20!white] (strect start) rectangle (strect end);
</span></span><span class="line"><span class="cl">  <span class="k">\end</span><span class="nb">{</span>pgfonlayer<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/layer.png"/>
</figure>

<h2 id="囲み枠fitting-library利用">囲み枠（Fitting Library利用）</h2>
<p><strong>参考</strong> PGF Manual, Part V, 54 Fitting Library</p>
<p>前節では、青色の四角形の座標を<code>\coordinate (strect start) ...</code>と<code>\coordinate (strect end) ...</code>で計算している。このケースではそこまで複雑ではないが、ノードの囲み枠の座標を計算せずに描画したいなら、Fittingライブラリが使える。</p>
<p><code>\node [fit=...] {};</code>で囲み枠を作成。<code>...</code>の部分にはスペース区切りのノードが入る。枠の余白を調整したいなら<code>inner sep</code>を指定する。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>positioning, graphs, fit<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\pgfdeclarelayer</span><span class="nb">{</span>background<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\pgfsetlayers</span><span class="nb">{</span>background, main<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\matrix</span> [row sep=2em, column sep=2em,
</span></span><span class="line"><span class="cl">           entity/.style=<span class="nb">{</span>draw, circle,
</span></span><span class="line"><span class="cl">                          minimum width=3em,
</span></span><span class="line"><span class="cl">                          outer sep=3pt,
</span></span><span class="line"><span class="cl">                          fill=white<span class="nb">}</span>] <span class="nb">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">\coordinate</span> (instart) at (0,0);
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (in0) <span class="nb">{</span> <span class="s">$</span><span class="nb">u_{k</span><span class="o">-</span><span class="m">1</span><span class="nb">}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (in1) <span class="nb">{</span> <span class="s">$</span><span class="nb">u_{k}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\\</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">\node</span> [] (ststart) <span class="nb">{</span> <span class="s">$</span><span class="nv">\cdots</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (st0) <span class="nb">{</span> <span class="s">$</span><span class="nb">x_{k</span><span class="o">-</span><span class="m">1</span><span class="nb">}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (st1) <span class="nb">{</span> <span class="s">$</span><span class="nb">x_{k}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [] (stend) <span class="nb">{</span> <span class="s">$</span><span class="nv">\cdots</span><span class="s">$</span> <span class="nb">}</span>;<span class="k">\\</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (ob0) <span class="nb">{</span> <span class="s">$</span><span class="nb">y_{k</span><span class="o">-</span><span class="m">1</span><span class="nb">}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\node</span> [entity] (ob1) <span class="nb">{</span> <span class="s">$</span><span class="nb">y_{k}</span><span class="s">$</span> <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="nb">&amp;</span> <span class="k">\coordinate</span> (obend) at (0,0); <span class="k">\\</span>
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\graph</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">      (ststart) -&gt; (st0) -&gt; (st1) -&gt; (stend);
</span></span><span class="line"><span class="cl">      (in0) -&gt; (st0) -&gt; (ob0);
</span></span><span class="line"><span class="cl">      (in1) -&gt; (st1) -&gt; (ob1);
</span></span><span class="line"><span class="cl">  <span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\begin</span><span class="nb">{</span>pgfonlayer<span class="nb">}{</span>background<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [fit=(in0) (in1) (ststart) (st0) (st1) (stend),
</span></span><span class="line"><span class="cl">           fill=blue!20!white,
</span></span><span class="line"><span class="cl">           inner sep=0pt] <span class="nb">{}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\end</span><span class="nb">{</span>pgfonlayer<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><p>結果の画像は前節と同様なので省略。</p>
<h2 id="関数のグラフの描画">関数のグラフの描画</h2>
<p><strong>参考</strong> PGF Manual, Part III, 22.5 Plotting a Function</p>
<p>簡単な関数の描画なら<code>plot</code>を使う。</p>
<p><code>plot</code>は<code>\draw</code>コマンドの中で指定できる。基本的には<code>plot (\x, {\xについての関数})</code>のような形で書く。<code>domain</code>で定義域、<code>samples</code>でサンプル数（大きいほど滑らか）を指定。
<code>\x^2</code>ではなく<code>(\x)^2</code>としないと2乗が正しく計算されないことに注意。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [domain=-1.5:1.5, samples=100] plot (<span class="k">\x</span>, <span class="nb">{</span>exp(-(<span class="k">\x</span>)<span class="nb">^</span>2/(2*0.1))/(2*pi*0.1)<span class="nb">}</span>);
</span></span><span class="line"><span class="cl">  <span class="k">\draw</span> [-&gt;, yshift=-0.5pt] (-1.6,0) -- (1.6,0) node [below] <span class="nb">{</span><span class="s">$</span><span class="nb">x</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> at (1, 1) <span class="nb">{</span><span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/plot.png"/>
</figure>

<p>あまり複雑な関数だとTeXでは効率的に計算できないらしいので、その場合はgnuplotと連携する方法を検討したほうが良いらしい（参考：PGF Manual, Part III, 22.6 Plotting a Function Using Gnuplot）。</p>
<p>gnuplotで連携する以外にも、pyplotなど外部プログラム予め画像を作っておき、それを<code>\includegraphics</code>で読み込む方法が考えられる。実際、TikZでは以下のように<code>node</code>の中に画像を埋め込める。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\node</span> at (0,0) <span class="nb">{</span><span class="k">\includegraphics</span><span class="na">[width=1cm, clip]</span><span class="nb">{</span>path/to/file.pdf<span class="nb">}}</span>;
</span></span></code></pre></div><h2 id="座標を使った平行移動">座標を使った平行移動</h2>
<p><code>xshift</code>で横軸方向、<code>yshift</code>で縦軸方向の平行移動が可能。
それだけでなく、<code>shift={(座標)}</code>で縦軸、横軸まとめて平行移動が可能。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\usetikzlibrary</span><span class="nb">{</span>calc, positioning<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> (a) <span class="nb">{</span>正規分布（<span class="s">$</span><span class="nv">\sigma</span><span class="nb">^</span><span class="m">2</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="m">0</span><span class="nb">.</span><span class="m">1</span><span class="s">$</span>）<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [right=1cm of a] (b) <span class="nb">{</span>正規分布（<span class="s">$</span><span class="nv">\sigma</span><span class="nb">^</span><span class="m">2</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="m">0</span><span class="nb">.</span><span class="m">2</span><span class="s">$</span>）<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\begin</span><span class="nb">{</span>scope<span class="nb">}</span>[shift=<span class="nb">{</span>(<span class="s">$</span><span class="o">(</span><span class="nb">a.south</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> </span><span class="o">(</span><span class="m">0</span><span class="nb">, </span><span class="o">-</span><span class="m">1</span><span class="nb">.</span><span class="m">7</span><span class="nb">cm</span><span class="o">)</span><span class="s">$</span>)<span class="nb">}</span>]
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> [domain=-1.5:1.5,
</span></span><span class="line"><span class="cl">           samples=100] plot (<span class="k">\x</span>, <span class="nb">{</span>exp(-(<span class="k">\x</span>)<span class="nb">^</span>2/(2*0.1))/(2*pi*0.1)<span class="nb">}</span>);
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> [-&gt;, yshift=-0.5pt] (-1.6,0) -- (1.6,0) node [below] <span class="nb">{</span><span class="s">$</span><span class="nb">x</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> at (1, 1) <span class="nb">{</span><span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\end</span><span class="nb">{</span>scope<span class="nb">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">\begin</span><span class="nb">{</span>scope<span class="nb">}</span>[shift=<span class="nb">{</span>(<span class="s">$</span><span class="o">(</span><span class="nb">b.south</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> </span><span class="o">(</span><span class="m">0</span><span class="nb">, </span><span class="o">-</span><span class="m">1</span><span class="nb">.</span><span class="m">7</span><span class="nb">cm</span><span class="o">)</span><span class="s">$</span>)<span class="nb">}</span>]
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> [domain=-1.5:1.5,
</span></span><span class="line"><span class="cl">           samples=100] plot (<span class="k">\x</span>, <span class="nb">{</span>exp(-(<span class="k">\x</span>)<span class="nb">^</span>2/(2*0.2))/(2*pi*0.2)<span class="nb">}</span>);
</span></span><span class="line"><span class="cl">    <span class="k">\draw</span> [-&gt;, yshift=-0.5pt] (-1.6,0) -- (1.6,0) node [below] <span class="nb">{</span><span class="s">$</span><span class="nb">x</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> at (1, 1) <span class="nb">{</span><span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">x</span><span class="o">)</span><span class="s">$</span><span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\end</span><span class="nb">{</span>scope<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/shift.png"/>
</figure>

<h2 id="図を拡大縮小するtikzの話ではない">図を拡大縮小する（TikZの話ではない）</h2>
<p>図がPDFの文書からはみ出たり、逆に小さすぎたりした場合、位置やフォント、図形のサイズをうまく調整して直すべきではあるのだが、それでも難しい場合の最終手段として「<code>tikzpicture</code>環境内の図形をまるごと拡大縮小する」がある。それには<code>\scalebox</code>コマンドを使う。これはTikZではなく、LaTeXのコマンドである（参考：<a href="https://latexref.xyz/_005cscalebox.html">LaTeX2e unofficial reference manual 22.3.3</a>）。以下のように、環境全体をくくって使う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"><span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">\node</span> [draw] <span class="nb">{</span>文章<span class="nb">}</span>;
</span></span><span class="line"><span class="cl"><span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="k">\scalebox</span><span class="nb">{</span>0.5<span class="nb">}{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\begin</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">\node</span> [draw] <span class="nb">{</span>文章<span class="nb">}</span>;
</span></span><span class="line"><span class="cl">  <span class="k">\end</span><span class="nb">{</span>tikzpicture<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">}</span>
</span></span></code></pre></div><figure><img src="./img/scalebox.png"/>
</figure>

<p>とはいえ、拡大縮小しすぎて図が見づらくなる危険があるため、むやみな使用は禁物かもしれない。</p>
<p>（<strong>補足</strong> <code>\begin{tikzpicture}[scale=0.5]...</code>のように<code>scale</code>を指定しても縮小可能なのではないか、と感じるが、実際は期待通りにはならない。この<code>scale</code>は座標系の縮尺を変更するだけで、図形やテキストのサイズには変化を及ぼさない。）</p>

</article>



</html>
